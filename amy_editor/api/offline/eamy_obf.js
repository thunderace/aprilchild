var fry={version:1,__production_mode:false};String.prototype.camelize=function(){return this.replace(/([-_].)/g,function(){return arguments[0].substr(1).toUpperCase()})};String.prototype.decamelize=function(){return this.replace(/([A-Z])/g,function(){return"-"+arguments[0].toLowerCase()})};String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};String.prototype.stripLines=function(){return this.replace(/\n/g,"")};String.prototype.stripMarkup=function(){return this.replace(/<(.|\n)+?>/g,"")};String.prototype.replaceMarkup=function(A){return this.replace(/(<(.|\n)+?>)/g,function(){var C="";for(var B=0;B<arguments[0].length;B++){C+=A}return C})};String.prototype.encodeMarkup=function(){return this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")};String.prototype.decodeMarkup=function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};String.prototype.surround=function(B,A){A=A||3;return(1==1&A?B:"")+this+(2==2&A?B:"")};String.prototype.surroundTag=function(A){return"<"+A+">"+this+"</"+A+">"};String.prototype.embed=function(){var t=this;if(1==arguments.length&&"object"==typeof arguments[0]){for(var i in arguments[0]){eval("var re=/@"+i+"/g;");t=t.replace(re,arguments[0][i])}}else{for(var i=0;i<arguments.length;i++){var ix=t.indexOf("?");if(-1!=ix){t=t.substr(0,ix)+arguments[i]+t.substr(ix+1);continue}break}}return t};var $__tune={__prop:{},isIE:("function"==typeof window.ActiveXObject),isSafari:-1!=navigator.appVersion.indexOf("AppleWebKit"),isOpera:-1!=navigator.appName.indexOf("pera"),isMac:-1!=navigator.appVersion.indexOf("intosh"),isGecko:false,node:{getOpacity:function(A){if(!A||!A.style){return 1}if($__tune.isIE){var B=A.style.filter;if(!B||-1==B.indexOf("alpha")){return 1}return 1}return parseFloat(A.style[$__tune.isGecko?"MozOpacity":"opacity"]||1)},setOpacity:function(B,A){if(!B||!B.style){return }if(0>A){A=0}if(1<A){A=1}if($__tune.isIE){B.style.filter="alpha(opacity="+(100*A)+")"}else{B.style.opacity=A;B.style.MozOpacity=A}},getPageScrollPosition:function(){var A=document.documentElement;if(A&&A.scrollTop){return[A.scrollLeft,A.scrollTop]}else{if(document.body){return[document.body.scrollLeft,document.body.scrollTop]}else{return[0,0]}}}},event:{get:function(A,B){if($notset(A.target)){A.target=A.srcElement;A.stopPropagation=function(){window.event.cancelBubble=true}}A.stop=function(){A.stopPropagation();A.stopped=true};A.$=$(A.target);if($notset(A.pageX)){A.pageX=A.clientX+document.body.scrollLeft;A.pageY=A.clientY+document.body.scrollTop}A.getOffsetX=function(){if($notset(A.offsetX)){var C=A.$.abspos();A.offsetX=A.pageX-C.x;A.offsetY=A.pageY-C.y}return A.offsetX};A.getOffsetY=function(){if($notset(A.offsetY)){var C=A.$.abspos();A.offsetX=A.pageX-C.x;A.offsetY=A.pageY-C.y}return A.offsetY};A.isAnyControlKeyPressed=function(){return A.metaKey||A.ctrlKey||A.altKey||A.shiftKey};A.KEY_ESCAPE=27;A.KEY_ENTER=13;A.KEY_ARR_RIGHT=39;A.KEY_ARR_LEFT=37;A.KEY_ARR_UP=38;A.KEY_ARR_DOWN=40;return A},addListener:function(B,A,C){if($__tune.isIE&&B.attachEvent){B.attachEvent("on"+A,C)}else{B.addEventListener(A,C,false)}},removeListener:function(B,A,C){if(B.detachEvent){B.detachEvent("on"+A,C);B["on"+A]=null}else{if(B.removeEventListener){B.removeEventListener(A,C,false)}}}},behavior:{disablePageScroll:function(){if($notset($__tune.__prop.page_scroll)){$__tune.__prop.page_scroll=[$().s().overflow,$().ga("scroll")]}$().s("overflow:hidden").sa("scroll","no")},enablePageScroll:function(){$().s("overflow:auto").sa("scroll","yes")},disableCombos:function(){$().g("select",function(A){A.sa("__dis_combo",A.s().visibility);$(A).v(false)})},enableCombos:function(){$().g("select",function(A){A.s({visibility:A.ga("__dis_combo")||"visible"})})},clearSelection:function(){try{if(window.getSelection){if($__tune.isSafari){window.getSelection().collapse()}else{window.getSelection().removeAllRanges()}}else{if(document.selection){if(document.selection.empty){document.selection.empty()}else{if(document.selection.clear){document.selection.clear()}}}}}catch(A){}},makeBodyUnscrollable:function(){$().s("position:fixed").w(fry.ui.info.page.width)}},ui:{scrollbarWidth:-1!=navigator.appVersion.indexOf("intosh")?15:17},selection:{setRange:function(B,C,D){if(B.setSelectionRange){B.focus();B.setSelectionRange(C,D)}else{if(B.createTextRange){var A=B.createTextRange();A.collapse(true);A.moveEnd("character",D);A.moveStart("character",C);A.select()}}}}};$__tune.isGecko=!$__tune.isSafari&&!$__tune.isIE&&-1!=navigator.userAgent.indexOf("ecko");$__tune.isSafari2=$__tune.isSafari&&-1!=navigator.appVersion.indexOf("Kit/4");$__tune.isSafari3=$__tune.isSafari&&-1!=navigator.appVersion.indexOf("Kit/5");function ACNode(A){this.$=A;if(A){A.setAttribute("fryis","1")}}ACNode.prototype.$$=function(A){return $$(A)};ACNode.prototype.is=function(){return this.$&&null!=this.$.parentNode};ACNode.prototype.i=function(A){if("undefined"==typeof A){return this.$.id||""}this.$.id=A;return this};ACNode.prototype.n=function(A){if("undefined"==typeof A){return this.$.className||""}this.$.className=A;return this};ACNode.prototype.e=function(C,G,D){var F="fryse-"+C;if(!G){if(null!=this.$.getAttribute(F)){var A=this.$.getAttribute(F).split(",");for(var B=0;B<A.length;B++){$__tune.event.removeListener(this.$,C,self[A[B]]);self[A[B]]=null}this.$["on"+C]=null;this.$.removeAttribute(F)}return this}var E=C+(""+Math.random()).substr(2);var A=null!=this.$.getAttribute(F)?this.$.getAttribute(F).split(","):[];A.push(E);this.$.setAttribute(F,A.join(","));self[E]=function(H){H.removeListener=function(){$__tune.event.removeListener(H.$.$,C,self[E]);G=null;H=null;self[E]=null};H=H||self.event;if(null!=G){G($__tune.event.get(H))}if(null!=H){if(D){H.removeListener();return }else{if(H.stopped){H=null}}}};this.$.setAttribute("fryhe",1);$__tune.event.addListener(this.$,C,self[E]);return this};function __fry_esupressed(A){A=A||self.event;if(!A.stopPropagation){A.cancelBubble=true}else{A.stopPropagation()}A=null;return false}ACNode.prototype.es=function(A){if($__tune.isIE&&this.$.attachEvent){this.$.attachEvent("on"+A,__fry_esupressed)}else{if(this.$.addEventListener){this.$.addEventListener(A,__fry_esupressed,false)}}};ACNode.prototype.x=function(A){if("undefined"==typeof A){return parseInt(this.$.style.left||0)}this.$.style.left=A+"px";return this};ACNode.prototype.y=function(A){if("undefined"==typeof A){return parseInt(this.$.style.top||0)}this.$.style.top=A+"px";return this};ACNode.prototype.abspos=function(C){if(document.getBoxObjectFor){var B=document.getBoxObjectFor(this.$);return{x:B.x,y:B.y}}if(this.$.getBoundingClientRect){var B=this.$.getBoundingClientRect();return{x:B.left+(document.documentElement.scrollLeft||document.body.scrollLeft),y:B.top+(document.documentElement.scrollTop||document.body.scrollTop)}}var B={x:0,y:0};var A=this.$;while(document.body!=A&&document!=A&&C!=A){B.x+=A.offsetLeft-A.scrollLeft;B.y+=A.offsetTop-A.scrollTop;if(A.offsetParent){A=A.offsetParent}else{A=A.parentNode}}return B};ACNode.prototype.pos=function(A){if("undefined"==typeof A){return"absolute"==this.$.style.position}this.$.style.position=A?"absolute":"relative";return this};ACNode.prototype.z=function(A){if("undefined"==typeof A){return parseInt(this.$.style.zIndex||0)}this.$.style.zIndex=A;return this};ACNode.prototype.w=function(A){if("undefined"==typeof A){return parseInt(this.$.style.width||this.$.offsetWidth)}this.$.style.width=A+"px";return this};ACNode.prototype.h=function(A){if("undefined"==typeof A){return parseInt(this.$.style.height||this.$.offsetHeight)}this.$.style.height=A+"px";if($__tune.isIE&&8>A){this.$.style.fontSize="1px"}return this};ACNode.prototype.s=function(C){if("undefined"==typeof C){return this.$.style}if("object"==typeof C){for(var E in C){this.$.style[E]=C[E]}}else{if("string"==typeof C){if(""!=C){var D=C.split(";");for(var A=0;A<D.length;A++){var B=D[A].split(":");if(2==B.length){this.$.style[B[0].trim().camelize()]=B[1].trim()}}}}}return this};ACNode.prototype.o=function(A){if("undefined"==typeof A){return $__tune.node.getOpacity(this.$)}$__tune.node.setOpacity(this.$,A);return this};ACNode.prototype.d=function(A){if("undefined"==typeof A){return"none"!=this.$.style.display}this.$.style.display=A?"block":"none";return this};ACNode.prototype.v=function(A){if("undefined"==typeof A){return"hidden"!=this.$.style.visibility}this.$.style.visibility=A?"visible":"hidden";return this};ACNode.prototype.t=function(A){if("undefined"==typeof A){return this.$.innerHTML}this.rc();this.$.innerHTML=A;return this};ACNode.prototype.p=function(A){if("undefined"==typeof A){return $(this.$.parentNode)}return $(A).a(this)};ACNode.prototype.g=function(E){var A=[];if("string"==typeof E){var G=E.split("/");E=[];for(var D=0;D<G.length;D++){var C=G[D].split(":");E[E.length]=C}}var F=function(M,N){if(!M){return }var I=E[N];var L=E.length-1==N;var H=M.getElementsByTagName(I[0]);var J=H.length;if(2==I.length){if(L){A.push($(H.item(parseInt(I[1]))))}else{F(H.item(parseInt(I[1])),N+1)}}else{for(var K=0;K<J;K++){if(L){A.push($(H.item(K)))}else{F(H.item(K),N+1)}}}H=null};F(this.$,0);F=null;var B=A.length;if(1==B){return A[0]}else{if(0==B){A=null}}return A};ACNode.prototype.gp=function(D){if("string"==typeof D){D=D.split("/")}var A=[];for(var B=0;B<D.length;B++){if(-1!=D[B].indexOf(":")){D[B]=D[B].split(":");for(var C=0;C<D[B][1];C++){A.push(D[B][0])}}else{A.push(D[B])}}var F=0;var E=this.$;while(E&&F<A.length){E=E.parentNode;if("*"==A[F]||A[F]==E.tagName.toLowerCase()){F++}}return $(E)};ACNode.prototype.a=function(A){if("undefined"!=typeof A["$"]){A=A.$}return $(this.$.appendChild(A))};ACNode.prototype.at=function(B){var A=this.$.innerHTML;this.$.innerHTML=A+B;return this};ACNode.prototype.r=function(A){A=$(A);if(null!=A&&A.is()){A.rs()}return this};ACNode.prototype.rc=function(){if(!this.$){return this}__fry_gcnode(this.$,true);return this};ACNode.prototype.rs=function(){if(!this.$){return }__fry_gcnode(this.$);this.$=null};ACNode.prototype.ib=function(B,A){if("undefined"!=typeof B["$"]){B=B.$}if("undefined"!=typeof A["$"]){A=A.$}return $(this.$.insertBefore(B,A))};ACNode.prototype.ia=function(B,A){if("undefined"!=typeof B["$"]){B=B.$}if(null==$(A).ns()){return $(this.$.appendChild(B))}else{return $(this.$.insertBefore(B,($(A).ns()).$))}};ACNode.prototype.fc=function(){if(!this.$){return null}var A=this.$.firstChild;while(null!=A&&1!=A.nodeType){A=A.nextSibling}return null!=A?$(A):null};ACNode.prototype.lc=function(){if(!this.$){return null}var A=this.$.lastChild;while(null!=A&&1!=A.nodeType){A=A.previousSibling}return null!=A?$(A):null};ACNode.prototype.ns=function(){var A=this.$.nextSibling;while(null!=A&&1!=A.nodeType){A=A.nextSibling}return null!=A?$(A):null};ACNode.prototype.ps=function(){var A=this.$.previousSibling;while(null!=A&&1!=A.nodeType){A=A.previousSibling}return null!=A?$(A):null};ACNode.prototype.ga=function(A){if(!this.$){return null}return this.$.getAttribute(A)};ACNode.prototype.sa=function(B,A){this.$.setAttribute(B,A);return this};ACNode.prototype.ra=function(A){this.$.removeAttribute(A);return this};ACNode.prototype.dup=function(){return $(this.$.cloneNode(true))};var $_=function(A){return""+A};var $$=function(A){return $(document.createElement(A||"div"))};var $=function(A){if("undefined"==typeof A){return $(document.body||document.getElementsByTagName("body").item(0))}if("undefined"==A||null==A){return null}if("object"!=typeof A){return new ACNode(document.getElementById(A))}else{if(A instanceof ACNode){return A}if(1!=A.nodeType){return null}return new ACNode(A)}};var $class=function(className,methods){if("string"!=typeof className){throw new FryException(29,"Class inheritance error. Undefined class name.")}var n=className.split("<");className=n[0].replace(/ /g,"");var bases=[];if(1==n.length){bases[0]="Object"}else{bases=n[1].split(",")}var getSource=function(s){s=""+s;return s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))};var getParams=function(s,p){p=p||{};s=""+s;s=s.substring(s.indexOf("(")+1,s.indexOf(")")).split(",");for(var i in s){var n=s[i].replace(/ /g,"");if(!p[n]&&""!=n){p[n]=true}}return p};var preprocessSource=function(s,cn){eval("var re = /"+cn+".([^\\(]*)\\(([\\)]*)/g;");s=s.replace(re,function(){return"this.__"+cn+"_"+arguments[1]+".call(this"+(""==arguments[2].replace(/ /g,"")?",":"")+arguments[2]});eval("re = /"+cn+"[^\\(]*\\(([\\)]*)/g;");s=s.replace(re,function(){return"this.__"+cn+"_construct.call(this"+(""==arguments[1].replace(/ /g,"")?",":"")+arguments[1]});return s};methods=methods||{};var c_code="";var d_code="";var params={};for(var i in bases){bases[i]=bases[i].replace(/ /g,"");if("Object"==bases[i]){continue}eval("var b_code="+bases[i]+";");params=getParams(b_code,params);b_code=getSource(b_code);c_code+=b_code+";";eval("var d_code="+bases[i]+'.prototype.destruct||"{}";');d_code=getSource(d_code);d_code+=d_code+";"}params=getParams(methods.construct||"",params);var p=[];for(var i in params){p.push(i)}if(methods.construct){oc_code=getSource(methods.construct);for(var i in bases){if("Object"!=bases[i]){oc_code=preprocessSource(oc_code,bases[i])}}c_code+=oc_code}d_code+=methods.destruct?getSource(methods.destruct):"";try{eval("var newClass=function("+p.join(",")+"){"+c_code+"};")}catch(e){throw new FryException(30,"Class inheritance error. Class `?`, constructor: `?`, error message: `?`.".embed(className,c_code,e))}newClass.prototype=new Object();for(var i in bases){if("Object"==bases[i]){continue}var p_base=bases[i].replace(/\./g,"_");eval("for(var m in "+bases[i]+".prototype){newClass.prototype[m]="+bases[i]+'.prototype[m]; if ("__" !=m.substr(0,2)) {newClass.prototype["__'+p_base+'_"+m]='+bases[i]+".prototype[m];}}")}newClass.prototype.__class_name=className;newClass.prototype.__base_class_names=bases;eval("newClass.prototype.construct=function("+p.join(",")+"){"+c_code+"};");eval("newClass.prototype.destruct=function(){"+d_code+"};");eval(className+"=newClass")};var $new=function(){if(!arguments[0]){throw new FryException(31,"Object instantiation error. Invalid class provided `?`.".embed(arguments[0]))}var arg_list=[];for(var i=1;i<arguments.length;i++){arg_list.push("arguments["+i+"]")}try{eval("var obj = new arguments[0]("+arg_list.join(",")+");")}catch(e){throw new FryException(32,"Object instantiation error. Class: `?`, num arguments: `?`, error message: `?`.".embed(arguments[0].prototype.__class_name,arg_list.length,e))}return obj};var $delete=function(B){if("object"!=typeof B){return }try{if("string"==typeof B.__base_class_names){var A=B.__base_class_names.split(",");for(var C in A){if("Object"!=A[C]){$call(B,A[C]+".destruct()")}}}if(B.destruct){B.destruct()}delete B}catch(D){}};var $call=function(){caller=arguments[0];var arg_list=[];for(var i=2;i<arguments.length;i++){arg_list.push("arguments["+i+"]")}try{eval("var r = caller.__"+arguments[1].replace(/\./g,"_")+".call(caller"+(0!=arg_list.length?",":"")+arg_list.join(",")+");")}catch(e){throw new FryException(32,"Function call error. Function `?`, num arguments: ?, error: `?`.".embed(arguments[1],arguments.length-2,e))}return r};var $runafter=function(A,B){setTimeout(B,A)};var $runinterval=function(G,F,A,E){var C=G;var D={from:G,to:F,stopped:false,stop:function(){this.stopped=true}};var B=self.setInterval(function(){if(C>F&&F>=G){self.clearInterval(B)}else{E(C,D);if(D.stopped){self.clearInterval(B)}}C++},A)};var $dotimes=function(C,B){for(var A=0;A<C;A++){B(A)}};var $foreach=function(D,F){if(!D){F=null;return }if("undefined"==typeof D.length&&"function"!=typeof D.__length){F=null;return }var E="function"==typeof D.__length?D.__length():D.length;var C={stopped:false,stop:function(){this.stopped=true},skipped:false,skip:function(){this.skipped=true},removed:false,remove:function(G){this.removed=true;this.stopped=true==G}};for(var A=0;A<E;A++){var B=null;if("function"==typeof D.item){B=D.item(A)}else{if("function"==typeof D.__item){B=D.__item(A)}else{if("undefined"==typeof D[A]){continue}B=D[A]}}F(B,"function"==typeof D.__key?D.__key(A):A,C);if(C.removed){C.removed=false;if("undefined"!=typeof D[A]){delete D[A]}else{if("function"==typeof D.removeItem){D.removeItem(A)}else{if("function"==typeof D.__remove){D.remove(A)}}}}if(C.stopped){break}if(C.skipped){C.skipped=false;continue}}C=null;F=null};var $notset=function(A){return("undefined"==typeof A||"undefined"==A||null==A)};var $isset=function(A){return("undefined"!=typeof A&&"undefined"!=A&&null!=A)};var $getdef=function(B,A){if("undefined"==typeof B||"undefined"==B||null==B){return A}return B};var $combofill=function(E,D){var B=-1;E=$(E);while(-1<++B){var A=D(B);if("object"!=typeof A){break}var C=E.a($$("option")).t(A[1]);C.$.value=A[0];if(A[2]){C.sa("selected","selected")}}return E};var $comboget=function(D){var A=[];var B=$(D).$.options;for(var C=0;C<B.length;C++){if(""!=B[C].selected){A[A.length]=B[C].value}}if(1==A.length){return A[0]}if(0==A.length&&0<B.length){return B[0].value}return A};var $comboset=function(E,A){var B=$(E).$.options;try{for(var C=0;C<B.length;C++){if(B[C].value==A){B[C].selected="selected"}}}catch(D){}return $(E)};function FryException(B,A){this.code=B;this.message=A}FryException.prototype.toString=function(){return"Fry Exception: code[?] message[?]".embed(this.code,this.message)};fry.remote={support:{getRequestObject:function(){var B=null;try{if($__tune.isIE){$foreach(["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],function(D,C,F){try{B=new ActiveXObject(D);F.stop()}catch(E){}})}else{B=new XMLHttpRequest()}}catch(A){}return B}},post:function(L,F,C,A){A=A||client.conf.fry.backendURL;if(!A){throw new FryException(1,"Undefined backend URL specified in client.conf. Use client.conf.fry.backendURL='{YOUR_BACKEND_SCRIPT_URL}'; to set it.")}var H=fry.remote.support.getRequestObject();if(!H){throw new FryException(2,"Unable to acquire HTTP request object. Check to see if your browser is among supported browsers.")}if(-1!=A.indexOf("?")){A=A.embed(F.a);delete F.a}H.open(C||"POST",A,true);H.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var D="";for(var B in F){var J=F[B];if("object"==typeof J){if(J.join){var E=J.length;for(var G=0;G<E;G++){J[G]=(""+J[G]).replace(/\],\[/g,"`Â§~Â§[]Â§~Â§`")}J="["+J.join("],[")+"]";B+="(a)"}else{var K="[";for(var G in J){K+=G+"="+(""+J[G]).replace(/\],\[/g,"`Â§~Â§[]Â§~Â§`")+"],["}J="["==K?"":K.substring(0,K.length-2);B+="(o)"}}D+=encodeURIComponent(B)+"="+encodeURIComponent(J)+"&"}H.send(D);var I=window.setInterval(function(){if(4==H.readyState){window.clearInterval(I);L(H)}},150)},result:function(J,G,H){var E;var C;try{E=J.status}catch(F){E=13030}if(200==E){var A=null;var D=J.getAllResponseHeaders();var I=(-1!=D.indexOf("/xml")&&J.responseXML)?"text/xml":"text/html";if("text/xml"==I){try{A=$xmlserialize(J.responseText)}catch(F){H("Error while serializing remote-side response. Probably corrupted data. Error: `?`. Sent data `?`.".embed(F.message,J.responseText))}try{G(A)}catch(F){throw new FryException(45,"fry/remote: Error while executing callback after successful remote call. Error: `?`.".embed(F.message))}}else{var B=J.responseText.substring(0,3);if("#S#"==B){A=J.responseText.substr(3);G(A)}else{if(""==J.responseText){H("No data returned from remote side.")}else{H("Invalid data returned from remote side: `?`.".embed(J.responseText.substr("#E#"==B?3:0)))}}}}else{switch(E){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:default:if(H){H("Connection ended up with status: "+E)}break}}delete J},upload:{lastAdapter:null,perform:function(A){var B=client.conf.fry.backendURL;if(!B){throw new FryException(19,"Undefined backend URL specified in client.conf. Use client.conf.fry.backendURL='{YOUR_BACKEND_SCRIPT_URL}'; to set it.")}fry.remote.upload.lastAdapter=A;if(null!=$("SWFUpload")){$("SWFUpload").rs()}$().a($$()).i("SWFUpload");mmSWFUpload.init({thirdPartyPath:client.conf.fry.path+"3rdparty",upload_backend:B+"?a="+A.onGetRemoteActionName(),target:"SWFUpload",allowed_filesize:A.allowedFileSizeInKBytes,allowed_filetypes:A.allowedFileTypes,upload_start_callback:"fry_remote_upload_onStart",upload_progress_callback:"fry_remote_upload_onProgress",upload_complete_callback:"fry_remote_upload_onComplete",upload_error_callback:"fry_remote_upload_onError",upload_cancel_callback:"fry_remote_upload_onCancel",upload_queue_complete_callback:"fry_remote_upload_onQueueComplete"});$("SWFUpload").pos(true).x(1).y(1).w(1).h(1);mmSWFUpload.callSWF()}}};function fry_remote_upload_onStart(A){fry.remote.upload.lastAdapter.onStart(A)}function fry_remote_upload_onProgress(B,A){fry.remote.upload.lastAdapter.onProgress(B,A)}function fry_remote_upload_onComplete(A){fry.remote.upload.lastAdapter.onEnd(false,false,A)}function fry_remote_upload_onError(A){fry.remote.upload.lastAdapter.onEnd(false,true,A)}function fry_remote_upload_onCancel(){fry.remote.upload.lastAdapter.onEnd(true)}function fry_remote_upload_onQueueComplete(){fry.remote.upload.lastAdapter.onQueueEnd()}$class("fry.remote.upload.Adapter",{construct:function(A,B,C){this.allowedFileSizeInKBytes=A||2000;this.allowedFileTypes=B||"*";this.additionalRemoteActionParams=C||""}});fry.remote.upload.Adapter.prototype.onStart=function(A){};fry.remote.upload.Adapter.prototype.onProgress=function(B,A){};fry.remote.upload.Adapter.prototype.onEnd=function(B,C,A){};fry.remote.upload.Adapter.prototype.onQueueEnd=function(){};fry.remote.upload.Adapter.prototype.onGetRemoteActionName=function(){return"upload?".embed(this.additionalRemoteActionParams?",?".embed(this.additionalRemoteActionParams):"")};fry.cookie={get:function(C){var B=document.cookie;var E=C+"=";var D=B.indexOf("; "+E);if(D==-1){D=B.indexOf(E);if(D!=0){return null}}else{D+=2}var A=document.cookie.indexOf(";",D);if(A==-1){A=B.length}return unescape(B.substring(D+E.length,A))},remove:function(A,C,B){if(getCookie(A)){document.cookie=A+"="+((C)?"; path="+C:"")+((B)?"; domain="+B:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT"}},set:function(C,E,A,G,D,F){var B=C+"="+escape(E)+((A)?"; expires="+A.toGMTString():"")+((G)?"; path="+G:"")+((D)?"; domain="+D:"")+((F)?"; secure":"");document.cookie=B}};var $post=fry.remote.post;var $result=fry.remote.result;var $rpost=function(D,A,C,E,B){E=E||"POST";B=B||client.conf.fry.backendURL;$post(function(F){$result(F,function(G){A(G)},function(G){C(G)})},D,E,B)};var $upload=function(A){fry.remote.upload.perform(A)};var __gc_trash_node=null;var __gc_running=false;var __gc_scheduled_timers=[];var __gc_started_at=0;function __fry_gcnode_inner(H){if(null!=H.getAttribute("frydrag")){$(H).removeDrag()}if(null!=H.getAttribute("frydnd")){$(H).removeDnD()}if(null==H.getAttribute("fryis")||null==H.getAttribute("fryhe")){H=null;return }H.removeAttribute("fryhe");var A=H.attributes;var B=A.length;for(var C=0;C<B;C++){var G=A.item(C).name;if(G&&"fryse"==G.substr(0,5)){var F=G.substr(6);var E=A.item(C).value.split(",");for(var D=0;D<E.length;D++){$__tune.event.removeListener(H,F,self[E[D]]);H["on"+F]=null;self[E[D]]=null}}attr=null}A=null;for(var C in H){if("on"==C.substr(0,2)&&"function"==typeof H[C]){H[C]=null}}H=null}function __fry_precaunode(C){var A=C.getElementsByTagName("*");for(var B=0;B<A.length;B++){if(""!=A.item(B).id){A.item(B).id=""}}A=null;C.id="";return C}function __fry_gcnode(B,A){if(null==__gc_trash_node){if(A){B.innerHTML=""}else{if(B.parentNode){B.parentNode.removeChild(B)}}return }if(A){try{while(null!=B.firstChild){__gc_trash_node.appendChild(__fry_precaunode(B.firstChild))}}catch(C){}}else{try{__gc_trash_node.appendChild(__fry_precaunode(B))}catch(C){}}__gc_scheduled_timers[__gc_scheduled_timers.length]=setTimeout("__fry_gc_recycle()",10000+Math.floor(10000*Math.random()))}function __fry_gc_time(){var A=new Date();return 60000*A.getMinutes()+1000*A.getSeconds()+A.getMilliseconds()}function __fry_gc_recycle(){var F=__gc_scheduled_timers.length;for(var C=0;C<F;C++){clearTimeout(__gc_scheduled_timers[C])}__gc_scheduled_timers=[];if(__gc_running){return }__gc_running=true;__gc_started_at=__fry_gc_time();while(null!=__gc_trash_node.firstChild){var E=__gc_trash_node.firstChild;if(1==E.nodeType){var A=E.getElementsByTagName("*");var B=A.length;if(__gc_started_at<__fry_gc_time()-2000){__gc_running=false;__gc_scheduled_timers[__gc_scheduled_timers.length]=setTimeout("__fry_gc_recycle()",7000+Math.floor(7000*Math.random()));return }for(var D=0;D<B;D++){__fry_gcnode_inner(A.item(D))}A=null}__gc_trash_node.removeChild(E);E=null}__gc_running=false}$__tune.event.addListener(self,"load",function(A){__gc_trash_node=document.getElementsByTagName("body").item(0).appendChild(document.createElement("div"));__gc_trash_node.style.display="none"});$__tune.event.addListener(self,"unload",function(A){__gc_trash_node=$().$;__fry_gc_recycle()});fry.keyboard={initialized:false,last_down_evt:null,ignore_further_events:false,stopped:true,paste:{was:false,none:function(){}},down:{none:function(){}},press:{none:function(){}},shared:{},buffer:[],listener:null,clipboard:{node:null,ie:{node:null},pastedContent:"",copiedContent:"",content:""},CONTROL_CODE:1,ALT_KEY:2,CTRL_KEY:4,SHIFT_KEY:8,META_KEY:16,COPY:128,CUT:256,PASTE:512,SIG_CLIPBOARD_GET:1024};fry.keyboard.initialize=function(){if(fry.keyboard.initialized){fry.keyboard.start();return }var react_as="none";if($__tune.isGecko){react_as="ff_"+($__tune.isMac?"mac":"win")}else{if($__tune.isSafari){react_as="webkit"}else{if($__tune.isIE){react_as="ie"}else{if($__tune.isOpera){react_as="opera"}}}}document.onscroll=function(evt){if(fry.keyboard.clipboard.node){fry.keyboard.clipboard.node.style.top=($__tune.isSafari?document.body.scrollTop:document.documentElement.scrollTop)+"px"}};if($__tune.isIE){document.body.onscroll=function(evt){if(fry.keyboard.clipboard.node){fry.keyboard.clipboard.node.style.top=document.documentElement.scrollTop+"px"}if(fry.keyboard.clipboard.ie.node){fry.keyboard.clipboard.ie.node.style.top=document.documentElement.scrollTop+"px"}}}var code="document.onkeydown = function(evt) {\n";code+="if (fry.keyboard.stopped) { return; }\n";code+="fry.keyboard.ignore_further_events = false;\n";code+="var result = null;\n";code+=$__tune.isIE?"evt = event;\n":"";code+=(""+fry.keyboard.paste[react_as]).replace(/function[ ]+\(evt\)/,"").replace(/return /g,"result=").replace(/^[^{]*{/,"").replace(/\}\s*$/,"").replace("fry.keyboard.shared.copy(evt);",(""+fry.keyboard.shared.copy).replace(/function[ ]+\(evt\)/,"").replace(/return /g,"result=").replace(/^[^{]*{/,"").replace(/\}\s*$/,""));code+="if (fry.keyboard.ignore_further_events) {	return;	}\n";code+="if (result) { fry.keyboard.prepareClipboard();	fry.keyboard.paste.was = true; fry.keyboard.clipboard.node.value = ''; fry.keyboard.clipboard.node.focus();	return true; }\n";code+="else { ";code+=$__tune.isIE?"if (86 == event.keyCode && event.ctrlKey){ fry.keyboard.clipboard.ie.node.value = ''; fry.keyboard.clipboard.ie.node.focus(); }\n":"";code+="}\n";code+=(""+fry.keyboard.down[react_as]).replace(/function[ ]+\(evt\)/,"").replace(/^[^{]*{/,"").replace(/\}\s*$/,"")+"\n}";code=code.replace(/fry\.keyboard\.([A-Z_]+)/g,function(){return fry.keyboard[arguments[1]]});eval(code);code="document.onkeypress = function(evt)	{\n";code+="if (fry.keyboard.stopped || fry.keyboard.ignore_further_events) { return; }\n";code+="if (fry.keyboard.paste.was) {\n";if(!$__tune.isIE){code+="setTimeout(function() {\n";if($__tune.isSafari){code+="var v = fry.keyboard.clipboard.node.value; if ('\\n\\n' == v.substr(v.length-2,2)) {v = v.substr(0, v.length-1);}fry.keyboard.clipboard.node.value = v;\n"}code+="fry.keyboard.pushKey(fry.keyboard.clipboard.node.value, fry.keyboard.CONTROL_CODE | fry.keyboard.PASTE); fry.keyboard.clipboard.node.blur(); fry.keyboard.paste.was = false;	}, 20);\n"}code+="return; }\n";if($__tune.isIE){code+="evt = event;\n"}code+=(""+fry.keyboard.press[react_as]).replace(/function[ ]+\(evt\)/,"").replace(/^[^{]*{/,"").replace(/\}\s*$/,"")+"\n}";code=code.replace(/fry\.keyboard\.([A-Z_]+)/g,function(){return fry.keyboard[arguments[1]]});eval(code);document.onkeydown2=function(evt){if(fry.keyboard.stopped){return }fry.keyboard.ignore_further_events=false;var result=fry.keyboard.paste[react_as](evt||event);if(fry.keyboard.ignore_further_events){return }if(result){fry.keyboard.prepareClipboard();fry.keyboard.paste.was=true;fry.keyboard.clipboard.node.value="";fry.keyboard.clipboard.node.focus();return true}else{if($__tune.isIE){if(86==event.keyCode&&event.ctrlKey){fry.keyboard.clipboard.ie.node.value="";fry.keyboard.clipboard.ie.node.focus()}}}return fry.keyboard.down[react_as](evt||event)};document.onkeypress2=function(evt){if(fry.keyboard.stopped||fry.keyboard.ignore_further_events){return }if(fry.keyboard.paste.was){if(!$__tune.isIE){setTimeout(function(){if($__tune.isSafari){var v=fry.keyboard.clipboard.node.value;if("\n\n"==v.substr(v.length-2,2)){v=v.substr(0,v.length-1)}fry.keyboard.clipboard.node.value=v}fry.keyboard.pushKey(fry.keyboard.clipboard.node.value,fry.keyboard.CONTROL_CODE|fry.keyboard.PASTE);fry.keyboard.clipboard.node.blur();fry.keyboard.paste.was=false},20)}return }return fry.keyboard.press[react_as](evt||event)};if($__tune.isIE){fry.keyboard.prepareClipboard();fry.keyboard.clipboard.ie={node:$().a($$("textarea")).pos(true).x(-2000).y(document.documentElement.scrollTop).w(20).h(20).e("paste",function(evt){if(fry.keyboard.stopped){return }setTimeout(function(){fry.keyboard.paste.was=false;fry.keyboard.pushKey(fry.keyboard.clipboard.ie.node.value,fry.keyboard.CONTROL_CODE|fry.keyboard.PASTE)},10)}).$}}if($__tune.isGecko&&$__tune.isMac){document.onkeyup=function(evt){if(evt.metaKey&&!evt.ctrlKey&&!evt.altKey&&!evt.shiftKey&&65<=evt.keyCode&&128>=evt.keyCode){fry.keyboard.pushKey(evt.keyCode+32,fry.keyboard.META_KEY);evt.preventDefault();return true}}}fry.keyboard.initialized=true;fry.keyboard.start()};fry.keyboard.start=function(){fry.keyboard.stopped=false};fry.keyboard.stop=function(){fry.keyboard.stopped=true};fry.keyboard.disableTextfieldsEditation=function(){fry.keyboard.allowTextfieldsEditation(true)};fry.keyboard.allowTextfieldsEditation=function(B){var A=document.getElementsByTagName("input");var E=A.length;for(var C=0;C<E;C++){var D=A.item(C);if("text"==D.type||"password"==D.type){if(B){D.onfocus=null;D.onblur=null;D.onkeydown=null;D.onkeypress=null;D.onkeyup=null;continue}$(D).e("keydown",function(F){F.stopPropagation()}).e("keypress",function(F){F.stopPropagation()}).e("keyup",function(F){F.stopPropagation()});D.onfocus=function(F){fry.keyboard.stop()};D.onblur=function(F){fry.keyboard.start()}}}A=document.getElementsByTagName("textarea");var E=A.length;for(var C=0;C<E;C++){var D=A.item(C);if(B){D.onfocus=null;D.onblur=null;D.onkeydown=null;D.onkeypress=null;D.onkeyup=null;continue}$(D).e("keydown",function(F){F.stopPropagation()}).e("keypress",function(F){F.stopPropagation()});D.onfocus=function(F){fry.keyboard.stop()};D.onblur=function(F){fry.keyboard.start()}}};fry.keyboard.prepareClipboard=function(){if(fry.keyboard.clipboard.node){return }fry.keyboard.clipboard.node=$().a($$("textarea")).w(20).h(20).pos(true).x(-2000).y($__tune.isSafari?document.body.scrollTop:document.documentElement.scrollTop).$};fry.keyboard.shared.copy=function(A){fry.keyboard.prepareClipboard();fry.keyboard.clipboard.copiedContent="";if(fry.keyboard.listener){var B=fry.keyboard.listener(0,fry.keyboard.CONTROL_CODE|fry.keyboard.SIG_CLIPBOARD_GET);if("string"==typeof B){fry.keyboard.clipboard.copiedContent=B}}fry.keyboard.clipboard.node.value=fry.keyboard.clipboard.copiedContent;fry.keyboard.clipboard.node.select();fry.keyboard.clipboard.node.focus();setTimeout("fry.keyboard.clipboard.node.blur()",200);fry.keyboard.clipboard.content=fry.keyboard.clipboard.copiedContent;fry.keyboard.ignore_further_events=true;fry.keyboard.pushKey(0,fry.keyboard.CONTROL_CODE|(88==A.keyCode?fry.keyboard.CUT:fry.keyboard.COPY));return false};fry.keyboard.paste.ff_win=function(A){return 86==A.keyCode&&0==A.charCode&&86==A.which&&A.ctrlKey};fry.keyboard.down.ff_win=function(A){fry.keyboard.last_down_evt=A;return true};fry.keyboard.press.ff_win=function(B){if(null!=fry.keyboard.last_down_evt){var A=(B.altKey?2:0)+(B.ctrlKey?4:0)+(B.shiftKey?8:0)+(B.metaKey?16:0);var C=!B.keyCode?B.charCode:B.keyCode;if(B.keyCode==B.charCode&&B.keyCode==fry.keyboard.last_down_evt.charCode){C=fry.keyboard.last_down_evt.keyCode}if(B.keyCode==fry.keyboard.last_down_evt.keyCode&&(0==B.which||32>B.keyCode)){A++}if(!fry.keyboard.pushKey(C,A)){return true}}B.preventDefault();B.stopPropagation();return false};fry.keyboard.paste.ff_mac=function(A){fry.keyboard.last_down_evt=null;if(A.metaKey&&((67==A.keyCode&&0==A.charCode&&67==A.which)||(88==A.keyCode&&0==A.charCode&&88==A.which))){return fry.keyboard.shared.copy(A)}else{return 86==A.keyCode&&0==A.charCode&&86==A.which&&A.metaKey}};fry.keyboard.down.ff_mac=function(A){return false};fry.keyboard.press.ff_mac=function(B){if(null!=fry.keyboard.last_down_evt){return }var A=(B.altKey?2:0)+(B.ctrlKey?4:0)+(B.shiftKey?8:0)+(B.metaKey?16:0);if(!B.charCode||(B.charCode==B.keyCode)){fry.keyboard.pushKey(B.keyCode,1+A)}else{if(!fry.keyboard.pushKey(B.charCode,A)){return true}}B.preventDefault();B.stopPropagation();return false};fry.keyboard.paste.webkit=function(A){if($__tune.isMac){return(86==A.keyCode&&(0==A.charCode||118==A.charCode)&&A.metaKey)}else{return(86==A.keyCode&&(0==A.charCode||118==A.charCode)&&A.ctrlKey)}};fry.keyboard.down.webkit=function(B){if(0!=B.keyCode&&(48>B.keyCode||(111<B.keyCode&&128>B.keyCode)||60000<B.charCode)){var A=(B.altKey?2:0)+(B.ctrlKey?4:0)+(B.shiftKey?8:0)+(B.metaKey?16:0);if(!B.charCode||111<B.keyCode||32>B.charCode||60000<B.charCode){fry.keyboard.pushKey(B.keyCode,1+A)}else{if(!fry.keyboard.pushKey(B.charCode,A)){return true}}B.preventDefault();B.stopPropagation();fry.keyboard.last_down_evt=null;return false}fry.keyboard.last_down_evt=B;return true};fry.keyboard.press.webkit=function(B){if(null!=fry.keyboard.last_down_evt){var A=(B.altKey?2:0)+(B.ctrlKey?4:0)+(B.shiftKey?8:0)+(B.metaKey?16:0);var C=!B.keyCode?B.charCode:B.keyCode;if(B.keyCode==B.charCode&&B.keyCode==fry.keyboard.last_down_evt.charCode&&B.keyCode>60000){C=fry.keyboard.last_down_evt.keyCode}if(B.keyCode==fry.keyboard.last_down_evt.keyCode&&48>B.keyCode){A++}else{var D=fry.keyboard.SHIFT_KEY+fry.keyboard.META_KEY;if(D==(A&D)&&97<=C&&122>=C){C-=32}}if(!fry.keyboard.pushKey(C,A)){return true}}B.preventDefault();B.stopPropagation();return false};fry.keyboard.paste.ie=function(A){if(A.ctrlKey&&(67==A.keyCode||88==A.keyCode)){return fry.keyboard.shared.copy(A)}else{return false}};fry.keyboard.down.ie=function(B){fry.keyboard.last_down_evt=B;if(48>B.keyCode||(111<B.keyCode&&128>B.keyCode)){var A=1+(B.altKey?2:0)+(B.ctrlKey?4:0)+(B.shiftKey?8:0)+(B.metaKey?16:0);return !fry.keyboard.pushKey(B.keyCode,A)}else{var C=B.keyCode;if(82==B.keyCode||65==B.keyCode||83==B.keyCode||70==B.keyCode||78==B.keyCode||84==B.keyCode){if(!B.shiftKey){C+=32}var A=(B.altKey?2:0)+(B.ctrlKey?4:0)+(B.shiftKey?8:0)+(B.metaKey?16:0);return !fry.keyboard.pushKey(C,A)}}return true};fry.keyboard.press.ie=function(B){if(null!=fry.keyboard.last_down_evt){var A=(B.altKey?2:0)+(B.ctrlKey?4:0)+(B.shiftKey?8:0)+(B.metaKey?16:0);return !fry.keyboard.pushKey(B.keyCode,A)}return false};fry.keyboard.paste.opera=function(A){return 86==A.keyCode&&86==A.which&&A.ctrlKey};fry.keyboard.down.opera=function(A){fry.keyboard.last_down_evt=A;return false};fry.keyboard.press.opera=function(B){var D=fry.keyboard.last_down_evt;var A=(B.altKey?2:0)+(B.ctrlKey?4:0)+(B.shiftKey?8:0)+(B.metaKey?16:0);var C=(D.altKey?2:0)+(D.ctrlKey?4:0)+(D.shiftKey?8:0)+(D.metaKey?16:0);if((B.keyCode==fry.keyboard.last_down_evt.keyCode||0==D.keyCode)&&(0==B.which||48>D.keyCode||111<D.keyCode)){A++}if(!fry.keyboard.pushKey(B.keyCode,A)){return true}B.preventDefault();B.stopPropagation();return false};fry.keyboard.addListener=function(A){fry.keyboard.listener=A};fry.keyboard.removeListener=function(A){fry.keyboard.listener=null};fry.keyboard.pushKey=function(D,B){if(32==D){B=B&65534}var F=false;var E=false;if($__tune.isMac){F=(99==D)&&(fry.keyboard.META_KEY==(B&fry.keyboard.META_KEY));E=(120==D)&&(fry.keyboard.META_KEY==(B&fry.keyboard.META_KEY))}else{F=(1==D||99==D)&&(fry.keyboard.CTRL_KEY==(B&fry.keyboard.CTRL_KEY));E=(24==D||120==D)&&(fry.keyboard.CTRL_KEY==(B&fry.keyboard.CTRL_KEY))}if(F||E){fry.keyboard.prepareClipboard();fry.keyboard.clipboard.copiedContent="";var A=false;if(fry.keyboard.listener){var C=fry.keyboard.listener(0,fry.keyboard.CONTROL_CODE|fry.keyboard.SIG_CLIPBOARD_GET);if("string"==typeof C){A=true;fry.keyboard.clipboard.copiedContent=C}}if(A){fry.keyboard.clipboard.node.value=fry.keyboard.clipboard.copiedContent;fry.keyboard.clipboard.node.select();fry.keyboard.clipboard.node.focus()}fry.keyboard.pushKey(0,fry.keyboard.CONTROL_CODE|(E?fry.keyboard.CUT:fry.keyboard.COPY));fry.keyboard.clipboard.content=fry.keyboard.clipboard.copiedContent;return !A}if(fry.keyboard.PASTE==(B&fry.keyboard.PASTE)){fry.keyboard.clipboard.pastedContent=D;fry.keyboard.clipboard.content=fry.keyboard.clipboard.pastedContent;D=0}if((17==D&&5==(B&5))||(16==D&&9==(B&9))||(18==D&&3==(B&3))){return true}if(118==D&&16==B){return true}if(fry.keyboard.listener){if(13!=D&&0!=(B&(fry.keyboard.CONTROL_CODE+fry.keyboard.META_KEY+fry.keyboard.CTRL_KEY))){return fry.keyboard.listener(D,B)}else{setTimeout("fry.keyboard.listener("+D+","+B+")",10)}}else{fry.keyboard.buffer.unshift([D,B])}return true};fry.keyboard.popKey=function(){return fry.keyboard.buffer.pop()};fry.keyboard.getClipboardContent=function(){return fry.keyboard.clipboard.content};var client={conf:{fry:{backendURL:""}}};var eamy={snippets:[],instances:[]};if("undefined"==typeof ac){var ac={chap:{}}}ac.chap={state:{active:null},TOKEN_MULTIROW_COMMENT:0,TOKEN_SINGLEROW_COMMENT:1,TOKEN_SINGLE_QUOTED:2,TOKEN_DOUBLE_QUOTED:3,TOKEN_NEWROW:4,TOKEN_WHITESPACE:5,ROWSTATE_NONE:0,ROWSTATE_FOLD_START:1,ROWSTATE_FOLD_STOP:2,ROWSTATE_FOLD_EXPAND:4,ROWSTATE_FOLD_COLLAPSED:8,ROWSTATE_SELECTION:16,ROWSTATE_BOOKMARK:32,CHUNK_KEYWORD:4,CHUNK_NUMBER:5,CHUNK_OPERATOR:6,CHUNK_PARENTHESIS:7,CHUNK_KEYWORD_CUSTOM:8,CHUNK_FUNCTION_NAME:9,CHUNK_LIBRARY:10,CHUNK_LIBRARY_CUSTOM:11,ACTION_CARET:1,ACTION_SELECTION:2,ACTION_INSERT:3,ACTION_UPDATE:4,ACTION_DELETE:5,ACTION_CLIPBOARD:6,ACTION_UNDO:7,ACTION_REDO:8,ACTION_CUSTOM:9,ACTION_RES_REDRAWCARET:1,ACTION_RES_REDRAWTEXT:2,ACTION_RES_SELECTIONCHANGED:4,ACTION_RES_SCROLLTOCARET:8,CKEY_NONE:0,CKEY_ALT:2,CKEY_CTRL:4,CKEY_SHIFT:8,CKEY_META:16,TRANSLOG_TYPE_INSERT:1,TRANSLOG_TYPE_REMOVE:2,ACTION_LISTENER_BEFORE:1,ACTION_LISTENER_AFTER:2,ACTION_LISTENER_BOTH:3};ac.chap.activeComponent=null;ac.chap.instanceId=1;ac.chap.getActiveComponent=function(){return ac.chap.activeComponent};ac.chap.setActiveComponent=function(A){fry.keyboard.initialize();if(null!=ac.chap.activeComponent){ac.chap.activeComponent.blur()}ac.chap.activeComponent=A;if(null!=A){if(ac.widget){ac.widget.focus(A)}ac.chap.activeComponent.focus()}else{if(!ac.widget){fry.keyboard.stop()}}};ac.chap.route=function(D,A,B,C){if(null==ac.chap.activeComponent){return }if("undefined"==typeof ac.chap.activeComponent.views[B]){return }switch(D){case"expand-folding":ac.chap.activeComponent.expandFolding(C)}};ac.chap.caretThread=setInterval(function(){if(null!=ac.chap.activeComponent){ac.chap.activeComponent.showCaret(true,true)}},600);$(document.documentElement).e($__tune.isSafari2?"mousedown":"click",function(A){var B=A.$.$;while(null!=B&&document.documentElement!=B){if("true"==B.getAttribute("chap-view")){A.stop();return }B=B.parentNode}ac.chap.setActiveComponent(null)});ac.chap.keyboardListener=function(B,A){if(null==ac.chap.activeComponent){return }return ac.chap.activeComponent.standaloneKeyboardListener(B,A)};if("undefined"==typeof ac.widget){fry.keyboard.addListener(ac.chap.keyboardListener)}$class("ac.chap.Window",{construct:function(A,B){this.instanceId=ac.chap.instanceId++;this.ident="ac-chap-"+this.instanceId;this.userId=B|0;this.caret=null;this.options=null;this.state=null;this.views=[];this.activeView=null;this.viewLayoutNodes=[];this.char_map=[];this.row_id_map=[];this.syntax_map=[];this.style_map=[];this.row_id_sequence=1;this.language=null;this.keymap=null;this.snippets=[];this.commands=[];this.selection=null;this.transaction_log=[];this.redo_log=[];this.setOptions(A||{});this.setState()},destruct:function(){$delete(this.state);$delete(this.options);$delete(this.char_map);$delete(this.row_id_map);$delete(this.syntax_map);$delete(this.style_map);this.hide();$delete(this.activeView)}});ac.chap.Window.prototype.focus=function(){this.showCaret()};ac.chap.Window.prototype.blur=function(){this.hideCaret()};ac.chap.Window.prototype.onFocus=function(){ac.chap.setActiveComponent(this);this.focus()};ac.chap.Window.prototype.onBlur=function(){ac.chap.setActiveComponent(null);this.blur()};ac.chap.Window.prototype.onResize=function(B,A){};ac.chap.Window.prototype.onSystemClipboardCopy=function(){return this.getSelection()};ac.chap.Window.prototype.onSystemClipboardCut=function(){this.runAction(ac.chap.ACTION_CLIPBOARD,{cut:true});return this.processActionResult(true,true)};ac.chap.Window.prototype.onSystemClipboardPaste=function(A){this.runAction(ac.chap.ACTION_CLIPBOARD,{paste:true,content:A});return this.processActionResult(true,true)};ac.chap.Window.prototype.hasKeyboardListenerActive=function(){return true};ac.chap.Window.prototype.onCut=function(B,A){};ac.chap.Window.prototype.onPaste=function(B,A){};ac.chap.Window.prototype.setOptions=function(A){this.options={initialCaretPosition:[0,0],tokenizerLazyLaunch:900,syntaxHighlightingEnabled:true,remoteBackendURL:"",font:{size:11,family:$__tune.isMac?"Consolas, 'Bitstream Vera Sans mono', 'Courier', 'Monaco', monospaced":"Consolas, 'Courier New', 'Courier', monospaced",allowedSizes:[8,9,10,11,12,13,14,17,21,24,27,30,34,38,42]}};if($isset(A.initial_caret_position)){this.options.initialCaretPosition=[A.initial_caret_position[0],A.initial_caret_position[1]]}if($isset(A.language)){this.language=$new(A.language)}else{this.language=$new(ac.chap.Language)}if($isset(A.keymap)){this.keymap=$new(A.keymap)}else{this.keymap=$new(ac.chap.KeyMap)}if($isset(A.syntaxHighlightingEnabled)){this.options.syntaxHighlightingEnabled=A.syntaxHighlightingEnabled}if($isset(A.remoteBackendURL)){this.options.remoteBackendURL=A.remoteBackendURL}else{if(client&&client.conf&&client.conf.fry){this.options.remoteBackendURL=client.conf.fry.backendURL}}if($isset(A.font)){if($isset(A.font.size)){this.options.font.size=A.font.size}if($isset(A.font.family)){this.options.font.family=A.font.family}}};ac.chap.Window.prototype.setState=function(){this.state={lastKeyTimePressed:0,caretPhase:1,lastKeyCode:0,lastControlKey:0,lastCaretPosition:[],tokenizerTimer:null,scheduledTokenizerTime:0,transactionLogStopped:false,actionListeners:[],actionListenersStopped:false,caretListener:null,commandListener:null,transactionListener:[null,800],passThroughKeysListener:null};this.caret={position:[this.options.initialCaretPosition[0],this.options.initialCaretPosition[1]],mode:1}};ac.chap.Window.prototype.addView=function(D,B,G){var A=this.views.length;this.viewLayoutNodes.push(D);this.views.push($new(ac.chap.View,this,A,B||{}));this.row_id_map[A]=[];if(0<A){var F=this.row_id_map[0].length;for(var C=0;C<F;C++){var E=this.row_id_map[0][C];this.row_id_map[A][C]=[E[0],false,E[2],[],[],[]]}}if(G){this.views[A].recalculateVisibleRows();this.views[A].render(this.viewLayoutNodes[A]);this.tokenize(0);this.renderText()}return A};ac.chap.Window.prototype.resizeView=function(A){if(this.views[A]){this.views[A].resize()}};ac.chap.Window.prototype.edit=function(C,A){this.char_map=[];for(var B=0;B<this.views.length;B++){}this.syntax_map=[];this.style_map=[];this.row_id_sequence=1;this.transaction_log=[];this.redo_log=[];this.insertIntoCharacterMap(C,0,0);this.tokenize(0);this.renderText();A=A||true;if(A){ac.chap.setActiveComponent(this);if(0<this.views.length){this.activeView=this.views[0]}}};ac.chap.Window.prototype.hide=function(){this.hideCaret();var B=this.views.length;for(var A=0;A<B;A++){this.views[A].hide();$delete(this.views[A])}$delete(this.views);ac.chap.setActiveComponent(null)};ac.chap.Window.prototype.show=function(){this.render();ac.chap.setActiveComponent(this)};ac.chap.Window.prototype.showInteractiveSearch=function(){if(this.activeView){this.activeView.showInteractiveSearch()}};ac.chap.Window.prototype.hideInteractiveSearch=function(){for(var A=0;A<this.views.length;A++){this.views[A].hideInteractiveSearch()}};ac.chap.Window.prototype.toggleBookmark=function(C){var C=C||this.caret.position[0];for(var A=0;A<this.views.length;A++){if("undefined"==typeof this.row_id_map[A][C]){return }this.row_id_map[A][C][1]=false;var B=this.row_id_map[A][C][2];if(ac.chap.ROWSTATE_BOOKMARK==(B&ac.chap.ROWSTATE_BOOKMARK)){this.row_id_map[A][C][2]&=(65535-ac.chap.ROWSTATE_BOOKMARK)}else{this.row_id_map[A][C][2]|=ac.chap.ROWSTATE_BOOKMARK}}};ac.chap.Window.prototype.setRuntimeOption=function(C,D){var F=this.options.font.allowedSizes;var A=this.options.font.size;var G=false;if("font"==C){if($isset(D.size)){if(F[0]<=D.size&&D.size<=F[F.length-1]){A=D.size;G=true}}if($isset(D.family)){this.options.font.family=D.family}}else{if("font.size"==C){if("bigger"==D){for(var B=0;B<F.length;B++){if(A<F[B]){A=F[B];break}}}else{if("smaller"==D){for(var B=F.length-1;B>=0;B--){if(A>F[B]){A=F[B];break}}}else{if(F[0]<=D&&D<=F[F.length-1]){A=D}}}this.options.font.size=A;G=true}else{if("font.family"==C){this.options.font.family=D;G=true}else{if("word.wrap"==C){if(this.activeView){this.hideCaret();this.activeView.options.wordWrap=D;this.activeView.reloadOptions();this.showCaret()}}}}}if(G){this.hideCaret();var E=this.views.length;for(var B=0;B<E;B++){this.views[B].reloadOptions()}this.showCaret()}};ac.chap.Window.prototype.scrollToBookmark=function(E,D){E=E||this.caret.position[0];var C=this.activeView;if(null==C){return }var B=this.row_id_map[C.index].length;if(0==B){return }var A=E+D;if(1==D){B=B-A}else{B=E}if(!this.findAndScrollToBookmark(C,A,B,D)){if(1==D){A=0;B=E}else{B=this.row_id_map[C.index].length;A=B-1;B-=E}this.findAndScrollToBookmark(C,A,B,D)}};ac.chap.Window.prototype.findAndScrollToBookmark=function(B,G,E,D){var C=0;var A=G;while(C<E){var F=this.row_id_map[B.index][A][2];if(ac.chap.ROWSTATE_BOOKMARK==(F&ac.chap.ROWSTATE_BOOKMARK)){B.scrollToRow(A,true);return true}A+=D;C++}return false};ac.chap.Window.prototype.setEditMode=function(A){this.caret.mode=A;ac.chap.setActiveComponent(this);this.tokenize();this.renderText()};ac.chap.Window.prototype.setTheme=function(B){for(var A=0;A<this.views.length;A++){this.views[A].setTheme(B)}};ac.chap.Window.prototype.setLanguage=function(A){this.language=$new(A);this.tokenize();this.foldingize();this.renderText();this.showCaret()};ac.chap.Window.prototype.setSnippets=function(A){this.snippets=A;this.keymap.importSnippets(A)};ac.chap.Window.prototype.setCommands=function(A){this.commands=A;this.keymap.importCommands(A)};ac.chap.Window.prototype.getTabelator=function(A){if(0<this.views.length){return this.views[0].options.tabelator}return"\t"};ac.chap.Window.prototype.setTabelator=function(B){for(var A=0;A<this.views.length;A++){this.views[A].options.tabelator=B}};ac.chap.Window.prototype.render=function(){for(var A=0;A<this.views.length;A++){this.views[A].render(this.viewLayoutNodes[A])}};ac.chap.Window.prototype.getTimestamp=function(){var A=new Date();return 60000*A.getMinutes()+1000*A.getSeconds()+A.getMilliseconds()};ac.chap.Window.prototype.keyboardListener=function(B,N){var M=false;var K=false;var L=false;var J=false;this.state.lastKeyTimePressed=new Date().getTime();var G=B;var Q=N&30;if(this.state.passThroughKeysListener&&this.state.passThroughKeysListener(G,Q)){return true}var F=$getdef(this.keymap.definition[G],this.keymap.definition[0]);F=$getdef(F[Q],F[ac.chap.CKEY_NONE]);if("undefined"==typeof F){F=this.keymap.definition[0][ac.chap.CKEY_NONE]}if(fry.keyboard.COPY==(N&fry.keyboard.COPY)){return true}var S=this;var O=F.length;for(var P=0;P<O;P+=2){var C=F[P];var R=F[P+1];R.keyCode=G;R.controlKey=Q;if(!this.state.actionListenersStopped){var D=this.caret.position[0];var A=this.caret.position[1];for(var I in this.state.actionListeners){var E=this.state.actionListeners[I];if(ac.chap.ACTION_LISTENER_BEFORE==(E[0]&ac.chap.ACTION_LISTENER_BEFORE)){if(!E[3]){E[2](S,E[1],ac.chap.ACTION_LISTENER_BEFORE,0,C,R,D,A)}else{setTimeout(function(){E[2](S,E[1],ac.chap.ACTION_LISTENER_BEFORE,0,C,R,D,A)},300)}}}}var H=this.runAction(C,R);if(!this.state.actionListenersStopped){var D=this.caret.position[0];var A=this.caret.position[1];for(var I in this.state.actionListeners){var E=this.state.actionListeners[I];if(ac.chap.ACTION_LISTENER_AFTER==(E[0]&ac.chap.ACTION_LISTENER_AFTER)){if(!E[3]){E[2](S,E[1],ac.chap.ACTION_LISTENER_AFTER,H,C,R,D,A)}else{setTimeout(function(){E[2](S,E[1],ac.chap.ACTION_LISTENER_AFTER,H,C,R,D,A)},300)}}}}if(!K){K=ac.chap.ACTION_RES_REDRAWCARET==(H&ac.chap.ACTION_RES_REDRAWCARET)}if(!M){M=ac.chap.ACTION_RES_REDRAWTEXT==(H&ac.chap.ACTION_RES_REDRAWTEXT)}if(!J){J=ac.chap.ACTION_RES_SELECTIONCHANGED==(H&ac.chap.ACTION_RES_SELECTIONCHANGED)}if(!L){L=ac.chap.ACTION_RES_SCROLLTOCARET==(H&ac.chap.ACTION_RES_SCROLLTOCARET)}}if(J){K=false;this.hideCaret()}else{this.state.lastCaretPosition=[this.caret.position[0],this.caret.position[1]];if(this.removeSelection()){M=true;K=true}}this.state.lastKeyCode=G;this.state.lastControlKey=Q;if(L){this.activeView.scrollToRow(this.caret.position[0],false,true)}this.processActionResult(M,K);return true};ac.chap.Window.prototype.standaloneKeyboardListener=function(B,A){if(fry.keyboard.CONTROL_CODE==(A&fry.keyboard.CONTROL_CODE)){if(fry.keyboard.PASTE==(A&fry.keyboard.PASTE)){return this.onSystemClipboardPaste(fry.keyboard.getClipboardContent())}else{if(fry.keyboard.CUT==(A&fry.keyboard.CUT)){return this.onSystemClipboardCut()}else{if(fry.keyboard.SIG_CLIPBOARD_GET==(A&fry.keyboard.SIG_CLIPBOARD_GET)){return this.onSystemClipboardCopy()}else{B=-B}}}}return this.keyboardListener(B,A)};ac.chap.Window.prototype.processActionResult=function(D,C){if(D){var A=this.getTimestamp();if(this.state.tokenizerTimer){clearTimeout(this.state.tokenizerTimer)}if(this.state.scheduledTokenizerTime<A-this.options.tokenizerLazyLaunch){this.tokenize(0);this.state.scheduledTokenizerTime=this.getTimestamp()+this.options.tokenizerLazyLaunch}else{var B=this;this.state.tokenizerTimer=setTimeout(function(){B.tokenize(0);B.state.scheduledTokenizerTime=B.getTimestamp();B.renderText();delete B},this.options.tokenizerLazyLaunch)}this.renderText()}if(C){this.showCaret()}};ac.chap.Window.prototype.setUserId=function(A){this.userId=A};ac.chap.Window.prototype.addCaretListener=function(A){this.state.caretListener=A};ac.chap.Window.prototype.removeCaretListener=function(A){this.state.caretListener=null};ac.chap.Window.prototype.addCommandListener=function(A){this.state.commandListener=A};ac.chap.Window.prototype.removeCommandListener=function(A){this.state.commandListener=null};ac.chap.Window.prototype.addPassThroughKeysListener=function(A){this.state.passThroughKeysListener=A};ac.chap.Window.prototype.removePassThroughKeysListener=function(){this.state.passThroughKeysListener=null};ac.chap.Window.prototype.addTransactionListener=function(B,A){this.state.transactionListener=[B,$getdef(A,800)]};ac.chap.Window.prototype.hasTransactionListener=function(){return null!=this.state.transactionListener&&null!=this.state.transactionListener[0]};ac.chap.Window.prototype.removeTransactionListener=function(A){this.state.transactionListener=null};ac.chap.Window.prototype.addActionListener=function(B,C,D,A){callbackIndex=this.state.actionListeners.length;this.state.actionListeners[callbackIndex]=[B,C,D,A];return callbackIndex};ac.chap.Window.prototype.removeActionListener=function(A){delete this.state.actionListeners[A]};ac.chap.Window.prototype.stopActionListeners=function(){this.state.actionListenersStopped=true};ac.chap.Window.prototype.startActionListeners=function(){this.state.actionListenersStopped=false};ac.chap.Window.prototype.getVariableValue=function(C,A){var B="";if("CHAP_SELECTED_TEXT"==C){B=this.getSelection()}else{if("CHAP_CLIPBOARD_TEXT"==C){B=fry.keyboard.getClipboardContent()}else{if("CHAP_PREV_WORD"==C){B=this.getWordAt(this.caret.position[0],this.caret.position[1],-1)}else{if("CHAP_NEXT_WORD"==C){B=this.getWordAt(this.caret.position[0],this.caret.position[1],1)}else{if(0==C.indexOf("CHAP_WORD")){words=[""];if(!isNaN(C.substr(9))){words=this.getWordAt(this.caret.position[0],this.caret.position[1],parseInt(C.substr(9)));if("string"==typeof words){words=[words]}}B=words[words.length-1]}}}}}if(""==B||null==B){B=A||""}return B};ac.chap.Window.prototype.runCommand=function(C,F,A,B,E,D){if(null==this.state.commandListener){console.warn("There is no command listener defined.");return 0}return this.state.commandListener(this,C,F,A,B,E,D)};ac.chap.Window.prototype.runAction=function(K,Y){var C=this.caret.position[0];var A=this.caret.position[1];var L=Y.keyCode;var X=Y.controlKey;switch(K){case ac.chap.ACTION_CARET:if($isset(Y.store)){this.state.lastCaretPosition=[C,A]}else{if($isset(Y.move)){var c=Y.move;if("left"==c){if(0<A){A--}else{if(0<C){C--;A=this.char_map[C].length}}this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}else{if("right"==c){if(this.char_map[C].length>A){A++}else{if("undefined"!=typeof this.char_map[C+1]){C++;A=0}}this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}else{if("up"==c){if(0<C){var d=this.char_map[C].length==A;if(d){A=this.char_map[C-1].length}else{A=Math.min(this.char_map[C-1].length,A)}this.setCaretPosition(C-1,A);return ac.chap.ACTION_RES_REDRAWCARET}}else{if("down"==c){if("undefined"!=typeof this.char_map[C+1]){var d=this.char_map[C].length==A;if(d){A=this.char_map[C+1].length}else{A=Math.min(this.char_map[C+1].length,A)}this.setCaretPosition(C+1,A);return ac.chap.ACTION_RES_REDRAWCARET}}else{if("prev_word"==c){if(0<A){var N=this.char_map[C].charAt(A-1);var R=this.language.wordDelimiter;var M=R.test(N);while(0!=A){N=this.char_map[C].charAt(A-1);if(M!=R.test(N)){break}A--}}else{if(0<C){C--;A=this.char_map[C].length}}this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}else{if("next_word"==c){if(this.char_map[C].length>A){var N=this.char_map[C].charAt(A);var R=this.language.wordDelimiter;var M=R.test(N);while(this.char_map[C].length>A){N=this.char_map[C].charAt(A);if(M!=R.test(N)){break}A++}}else{if("undefined"!=typeof this.char_map[C+1]){C++;A=0}}this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}else{if("prev_regexp"==c){if(0<A){var J=this.char_map[C].substring(0,A);var R=new RegExp(Y.re.replace("|","\\"));var B=R.exec(J);if(0==B.length){console.warning("Invalid RE definition for `prev_regexp' direction in ACTION_CARET.move action in keymap.");A--}else{A-=B[0].length+1}}else{if(0<C){C--;A=this.char_map[C].length}}this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}else{if("next_regexp"==c){if(this.char_map[C].length>A){var J=this.char_map[C].substr(A+1);var R=new RegExp(Y.re.replace("|","\\"));var B=R.exec(J);if(0==B.length){console.warning("Invalid RE definition for `next_regexp' direction in ACTION_CARET.move action in keymap.");A++}else{A+=B[0].length+1}}else{if("undefined"!=typeof this.char_map[C+1]){C++;A=0}}this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}else{if("row_start"==c){if(0<A){A=0;this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}}else{if("row_end"==c){if(this.char_map[C].length>A){A=this.char_map[C].length;this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}}else{if("page_up"==c){if(this.activeView){var J=C-this.activeView.numRows;if(0>J){J=0}this.setCaretPosition(J,0!=A?this.char_map[J].length:0);return ac.chap.ACTION_RES_REDRAWCARET}return 0}else{if("page_down"==c){if(this.activeView){var J=C+this.activeView.numRows;if(this.char_map.length<=J){J=this.char_map.length-1}this.setCaretPosition(J,0!=A?this.char_map[J].length:0);return ac.chap.ACTION_RES_REDRAWCARET}return 0}else{if("doc_start"==c){this.setCaretPosition(0,0);return ac.chap.ACTION_RES_REDRAWCARET}else{if("doc_end"==c){var S=this.char_map.length-1;this.setCaretPosition(S,this.char_map[S].length-1);return ac.chap.ACTION_RES_REDRAWCARET}}}}}}}}}}}}}}}else{if($isset(Y.moveBy)){var H=Y.moveBy;if("column"==H){if(0<Y.value){var V=(this.char_map[C].substr(A)+"\n"+this.char_map.slice(C+1).join("\n")).substr(0,Y.value);V=V.split("\n");C+=V.length-1;A=V[V.length-1].length+(1==V.length?A:0)}else{var V=(this.char_map.slice(0,C).join("\n")+"\n"+this.char_map[C].substr(0,A));V=V.substr(V.length+Y.value);V=V.split("\n");C-=(V.length-1);A=(1==V.length?A:this.char_map[C].length)-V[0].length}this.setCaretPosition(C,A);return ac.chap.ACTION_RES_REDRAWCARET}else{if("row"==H){}else{if("page"==H){}}}}else{if($isset(Y.moveTo)){this.setCaretPosition(Y.moveTo[0],Y.moveTo[1]);return ac.chap.ACTION_RES_REDRAWCARET}}}}break;case ac.chap.ACTION_SELECTION:if($isset(Y.remove)){var I=this.removeSelection();return ac.chap.ACTION_RES_REDRAWCARET|(I?ac.chap.ACTION_RES_REDRAWTEXT:0)}else{if($isset(Y.add)){this.addSelection([C,A],this.state.lastCaretPosition);this.renderSelection();return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_SELECTIONCHANGED}else{if($isset(Y.all)){$__tune.behavior.clearSelection();this.addAllSelection();this.renderSelection();return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_SELECTIONCHANGED}}}break;case ac.chap.ACTION_INSERT:var T=null;if($isset(Y.row)){var E="\n";A=0;this.insertIntoCharacterMap(E);this.setCaretPosition(C+1,A);return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT}else{if($isset(Y.character)){if(31<L||-9==L){T=-9==L?"\t":String.fromCharCode(L)}}else{if($isset(Y.string)){T=Y.string}}}if(null!=T){if(null!=this.selection){var U=[this.selection.startPosition[0],this.selection.startPosition[1]];var b=[this.selection.endPosition[0],this.selection.endPosition[1]];var G=false;if((b[0]<U[0])||(b[0]==U[0]&&b[1]<U[1])){var O=U;U=b;b=O;G=true}this.removeFromCharacterMap(U[0],U[1]+(G?0:0),b[0],b[1]+(G?0:1));this.setCaretPosition(U[0],U[1]);C=U[0];A=U[1];this.removeSelection()}else{if(2==this.caret.mode){this.removeFromCharacterMap(C,A)}}this.insertIntoCharacterMap(T);if(!Y.skipCaretChange){if(-1==T.indexOf("\n")){A+=T.length}else{C+=T.length-T.replace(/\n/g,"").length;A=T.length-T.lastIndexOf("\n")-1}this.setCaretPosition(C,A)}return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT}break;case ac.chap.ACTION_UPDATE:break;case ac.chap.ACTION_DELETE:if($isset(Y.row)){if(this.getNumRows()==C+1){if(0==C){this.removeFromCharacterMap(C,0,C,this.char_map[C].length);this.setCaretPosition(0,0)}else{this.removeFromCharacterMap(C-1,this.char_map[C-1].length,C,this.char_map[C].length);this.setCaretPosition(C-1,this.char_map[C-1].length)}}else{this.removeFromCharacterMap(C,0,C+1,0)}return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT}else{if($isset(Y.character)){var a=!Y.character;var P=true;if(null!=this.selection){var U=[this.selection.startPosition[0],this.selection.startPosition[1]];var b=[this.selection.endPosition[0],this.selection.endPosition[1]];var G=false;if((b[0]<U[0])||(b[0]==U[0]&&b[1]<U[1])){var O=U;U=b;b=O;G=true}this.removeFromCharacterMap(U[0],U[1],b[0],b[1]+(G?0:1));C=U[0];A=U[1]+(a?0:1);this.removeSelection()}else{var U=[C,A];var b=[C,A];if(a){if(A==this.char_map[U[0]].length){if(this.char_map.length-1==C){P=false}else{b[0]++;b[1]=0}}else{b[1]++}}else{if(0==A){if(0==C){P=false}else{U[0]--;U[1]=this.char_map[U[0]].length}}else{U[1]--}C=U[0];A=U[1]+1}if(P){this.removeFromCharacterMap(U[0],U[1],b[0],b[1]);this.removeSelection()}}if(P){this.setCaretPosition(C,A-(a?0:1));return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT}}}break;case ac.chap.ACTION_CLIPBOARD:if($isset(Y.cut)){if(null!=this.selection){return this.runAction(ac.chap.ACTION_DELETE,{character:true})}}else{if($isset(Y.paste)){this.runAction(ac.chap.ACTION_INSERT,{string:Y.content});return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT}}break;case ac.chap.ACTION_UNDO:var F=this.transaction_log.length;if(3<F){var W=this.transaction_log[F-3];var Y=this.transaction_log[F-2];var Q=this.transaction_log[F-1];if(ac.chap.TRANSLOG_TYPE_INSERT==W){var U=[Y[0],Y[1]];var b=[Y[0],Y[1]];b[0]+=(Q.length-Q.replace(/\n/g,"").length);var D=Q.lastIndexOf("\n");b[1]=-1==D?(U[1]+Q.length):(Q.length-D);this.removeFromCharacterMap(U[0],U[1],b[0],b[1]);C=U[0];A=U[1]}else{if(ac.chap.TRANSLOG_TYPE_REMOVE==W){this.insertIntoCharacterMap(Q,Y[0],Y[1]);C=Y[2];A=Y[3]}}this.setCaretPosition(C,A);this.removeSelection();this.redo_log=[].concat(this.redo_log,this.transaction_log.slice(F-3,F));this.transaction_log=[].concat(this.transaction_log.slice(0,F-3));return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT}break;case ac.chap.ACTION_REDO:var F=this.redo_log.length;if(0<F){var W=this.redo_log[F-3];var Y=this.redo_log[F-2];var Q=this.redo_log[F-1];this.redo_log=[].concat(this.redo_log.slice(0,F-3));if(ac.chap.TRANSLOG_TYPE_REMOVE==W){this.removeFromCharacterMap(Y[0],Y[1],Y[2],Y[3]);C=Y[0];A=Y[1];this.setCaretPosition(C,A);this.removeSelection()}else{if(ac.chap.TRANSLOG_TYPE_INSERT==W){this.runAction(ac.chap.ACTION_INSERT,{string:Q})}}return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT}break;case ac.chap.ACTION_CUSTOM:var Z="action_?".embed($getdef(Y.action,"NotDefined"));if(!this.keymap[Z]){console.warn("Action `%s` not defined in the keymap.",Y.action);Z="action_NotDefined"}return this.keymap[Z](L,X,C,A,this,Y);break}return 0};ac.chap.Window.prototype.getActiveViewIndex=function(){if(null==this.activeView){return -1}return this.activeView.index};ac.chap.Window.prototype.getCharAt=function(B,A){B=$getdef(B,this.caret.position[0]);A=$getdef(A,this.caret.position[1]);return this.char_map[B].charAt(A)};ac.chap.Window.prototype.getStringAt=function(D,B,A){D=$getdef(D,this.caret.position[0]);B=$getdef(B,this.caret.position[1]);A=$getdef(A,-1);var C="";if(0>A){C=this.char_map.slice(0,D).join("\n")+"\n"+this.char_map[D].substr(0,B);return C.substr(C.length+A)}else{C=this.char_map.slice(D).join("\n").substr(B);return C.substr(0,A)}};ac.chap.Window.prototype.getWordAt=function(I,B,E){I=$getdef(I,this.caret.position[0]);B=$getdef(B,this.caret.position[1]);E=$getdef(E,-1);var D=[];var H=this.language.wordDelimiter;var F=E;var C=0<E;var G=true;F=Math.abs(-E);if(!C){B--;if(-1==B){I--;if(-1==I){return D}B=this.char_map[I].length-1}}while(true){var A=this.char_map[I].charAt(B);if(H.test(A)){if(G){D.push("");G=false}if(C){D[D.length-1]+=A}else{D[D.length-1]=A+D[D.length-1]}}else{if(F==D.length){break}G=true}B+=(C?1:-1);if(0>B){I--;if(-1==I){break}G=true;B=this.char_map[I].length-1}else{if(this.char_map[I].length<=B){I++;if(this.char_map.length==I){break}G=true;B=0}}}if(1==F){return D[0]?D[0]:false}return D};ac.chap.Window.prototype.getLineAt=function(A){return this.char_map[A]};ac.chap.Window.prototype.getText=function(){return this.char_map.join("\n")};ac.chap.Window.prototype.getNumRows=function(){return this.char_map.length};ac.chap.Window.prototype.getSyntaxHighlightingSource=function(){if(null!=this.activeView){return this.activeView.getSyntaxHighlightingSource()}return"ni"};ac.chap.Window.prototype.getCaretAbsolutePosition=function(){if(null!=this.activeView){var B=this.activeView.getRenderedCharPosition(this.caret.position[0],this.caret.position[1]);if(null!=B){var A=this.activeView.nodeScrollArea.abspos();return[B[0]+A.x+this.activeView.options.colWidth,B[1]+A.y+this.activeView.options.rowHeight]}}return null};ac.chap.Window.prototype.stopTransactionLog=function(){this.state.transactionLogStopped=true};ac.chap.Window.prototype.startTransactionLog=function(){this.state.transactionLogStopped=false};ac.chap.Window.prototype.addAllSelection=function(){var A=this.char_map.length;var D=this.views.length;for(var B=0;B<A;B++){for(var C=0;C<D;C++){this.row_id_map[C][B][2]=this.row_id_map[C][B][2]|ac.chap.ROWSTATE_SELECTION;this.row_id_map[C][B][5][0]=0;this.row_id_map[C][B][5][1]=this.char_map[B].length}}this.selection={startPosition:[0,0],endPosition:[A-1,this.char_map[A-1].length]}};ac.chap.Window.prototype.addSelection=function(C,F){var H=this.views.length;if(null==this.selection){F=F||C;this.selection={};this.selection.startPosition=[F[0],F[1]]}else{var G=Math.min(this.selection.startPosition[0],this.selection.endPosition[0]);var B=Math.max(this.selection.startPosition[0],this.selection.endPosition[0]);for(var D=G;D<=B;D++){for(var I=0;I<H;I++){this.row_id_map[I][D][2]=(this.row_id_map[I][D][2]&(65535-ac.chap.ROWSTATE_SELECTION))}}F=[this.selection.startPosition[0],this.selection.startPosition[1]]}if((C[0]<F[0])||(C[0]==F[0]&&C[1]<F[1])){F[1]--}else{C[1]--}this.selection.endPosition=[C[0],C[1]];if((C[0]<F[0])||(C[0]==F[0]&&C[1]<F[1])){var A=F;F=C;C=A}for(var D=0;D<H;D++){for(var I=F[0];I<=C[0];I++){this.row_id_map[D][I][2]=ac.chap.ROWSTATE_SELECTION;var E=[0,this.char_map[I].length];if(F[0]==I){E[0]=F[1]}if(C[0]==I){E[1]=C[1]}this.row_id_map[D][I][5][0]=E[0];this.row_id_map[D][I][5][1]=E[1]}}};ac.chap.Window.prototype.removeSelection=function(H,B){var E=this.views.length;var A=this.char_map.length;var G=false;for(var C=0;C<E;C++){for(var D=0;D<A;D++){var F=this.row_id_map[C][D][2];if(ac.chap.ROWSTATE_SELECTION==(F&ac.chap.ROWSTATE_SELECTION)){this.row_id_map[C][D][1]=false;this.row_id_map[C][D][2]=F&(65535-ac.chap.ROWSTATE_SELECTION);this.row_id_map[C][D][5][0]=null;this.row_id_map[C][D][5][1]=null;G=true}}}this.selection=null;return G};ac.chap.Window.prototype.getSelection=function(){var C="";if(null!=this.selection){var D=[this.selection.startPosition[0],this.selection.startPosition[1]];var A=[this.selection.endPosition[0],this.selection.endPosition[1]];if((A[0]<D[0])||(A[0]==D[0]&&A[1]<D[1])){var B=D;D=A;A=B}if(D[0]==A[0]){C=this.char_map[D[0]].substring(D[1],A[1]+1)}else{C=this.char_map[D[0]].substr(D[1]);C=[].concat(C,this.char_map.slice(D[0]+1,A[0]),this.char_map[A[0]].substr(0,A[1]+1)).join("\n")}}return C};ac.chap.Window.prototype.getCaretPosition=function(){return[this.caret.position[0],this.caret.position[1]]};ac.chap.Window.prototype.setCaretPosition=function(B,A){this.caret.position[0]=parseInt(B);this.caret.position[1]=parseInt(A)};ac.chap.Window.prototype.renderText=function(B){var C=this.views.length;for(var A=0;A<C;A++){this.views[A].renderText(B)}};ac.chap.Window.prototype.renderSelection=function(){var B=this.views.length;for(var A=0;A<B;A++){this.views[A].renderSelection()}};ac.chap.Window.prototype.showCaret=function(A,C){if(new Date().getTime()-500<this.state.lastKeyTimePressed){this.state.caretPhase=1}var F=this.views.length;for(var B=0;B<F;B++){if(this.activeView==this.views[B]&&null==this.selection){this.views[B].showCaret(A?true:false);if(null!=this.state.caretListener&&!C){var E=this.state.caretListener;var D=this.caret.position[0];var G=this.caret.position[1];$runafter(30,function(){E(D,G);delete E})}}else{this.views[B].hideCaret()}}this.state.caretPhase=++this.state.caretPhase&1};ac.chap.Window.prototype.hideCaret=function(){var B=this.views.length;for(var A=0;A<B;A++){this.views[A].hideCaret()}};ac.chap.Window.prototype.captureEditAreaClick=function(P,N){P.stop();this.hideInteractiveSearch();this.activeView=N;var M=P.$.abspos();var E=P.pageX-M.x;var D=P.pageY-M.y+($__tune.isGecko?N.nodeScrollArea.$.scrollTop:0);var K=P.$.$;var Q=false;while(null!=K&&K.tagName&&"pre"!=K.tagName.toLowerCase()){if(!$__tune.isOpera){E+=K.offsetLeft;D+=K.offsetTop;Q=true}K=K.parentNode}var L=this.char_map.length-1;if(K.tagName&&Q){D-=K.offsetTop}if(null==K){return }var L=K.getAttribute?parseInt(K.getAttribute("row-index")):L;var A=1;var B=0;if(N.options.wordWrap){A=1+Math.floor(D/N.options.rowHeight)}var G=0;var I=this.char_map[L].length;var F=N.getRenderedCharDimension()[0]/2;var J=0;var C=0;var O=N.options.colWidth*N.numCols;while(G<I){var H=N.getRenderedStringDimension(L,0,G);if((Math.floor(H[0]/O)+1)==A){if(H[0]%O>E-F){B=G;break}else{if(O-F<E&&(H[0]%O+2*F>=E)){B=G+1;break}}}G++}if(G==I){B=G}this.hideCaret();if(P.shiftKey){this.addSelection([L,B],this.state.lastCaretPosition);this.renderText()}else{this.setCaretPosition(L,B);this.state.caretPhase=1;N.showCaret();this.state.lastCaretPosition=[this.caret.position[0],this.caret.position[1]];if(this.removeSelection()){this.renderText()}}ac.chap.setActiveComponent(this)};ac.chap.Window.prototype.foldingize=function(){var J=0;var L=this.char_map.slice(J);var C=L.length;var B=[];var F=-1;for(var G=0;G<this.language.foldingStartMarkers.length;G++){var H=this.language.foldingStartMarkers[G];var A=this.language.foldingParityMarkers[G];var E=this.language.foldingStopMarkers[G];for(var K=J;K<C;K++){if(H.test(this.char_map[K])){B.push([K,-1,0]);F=B.length-1}if(null!=A&&A.exec(this.char_map[K])){var D=F;while(0<=D){if(-1==B[D][1]){B[D][2]++;break}D--}}if(E.exec(this.char_map[K])){var D=F;while(0<=D){if(-1==B[D][1]){B[D][2]--;if(0==B[D][2]){B[D][1]=K}break}D--}}}}C=B.length;for(G=0;G<C;G++){var I=B[G];if(I[0]==I[1]||-1==I[1]){continue}for(var K=0;K<this.views.length;K++){this.row_id_map[K][I[0]][2]|=ac.chap.ROWSTATE_FOLD_START;this.row_id_map[K][I[0]][3][0]=0;this.row_id_map[K][I[0]][3][1]=I[1];this.row_id_map[K][I[1]][2]|=ac.chap.ROWSTATE_FOLD_STOP;this.row_id_map[K][I[1]][3][0]=0;this.row_id_map[K][I[1]][3][1]=I[0]}}};ac.chap.Window.prototype.tokenize=function(){if(!this.options.syntaxHighlightingEnabled){return }var e=0;this.foldingize();var X=this.char_map.slice(e).join("\n");var I=this.char_map.length;var S=[];var G=this.language.multiRowCommentStartMarker;var J=this.language.multiRowCommentEndMarker;var a=this.language.singleQuoteStringMarker;var Q=this.language.singleQuoteStringMarkerException;var T=this.language.doubleQuoteStringMarker;var R=this.language.doubleQuoteStringMarkerException;var Y=this.language.singleRowCommentStartMarkers;var E={row:e,col:0};var M=0;var Z=function(m,h,l,k){k=k||"";if(-1==l){l=I}for(var j=h;j<l;j++){if("undefined"==typeof S[j]){S[j]=[]}S[j]=[[m,-1,-1,k]]}};var N=[[ac.chap.TOKEN_MULTIROW_COMMENT,-1,G,J,""],[ac.chap.TOKEN_SINGLE_QUOTED,-1,a,a,Q],[ac.chap.TOKEN_DOUBLE_QUOTED,-1,T,T,R]];for(i=0;i<Y.length;i++){N.push([ac.chap.TOKEN_SINGLEROW_COMMENT,-1,Y[i],"\n",""])}while(true){if(""!=G){N[0][1]=X.indexOf(G)}if(""!=a){N[1][1]=X.indexOf(a)}if(""!=T){N[2][1]=X.indexOf(T)}for(i=0;i<Y.length;i++){if(""!=Y[i]){N[3+i][1]=X.indexOf(Y[i])}}var d=-1;var g=X.length;for(i=0;i<N.length;i++){if(-1!=N[i][1]){if(g>N[i][1]){d=i;g=N[i][1]}}}if(-1==d){break}var L=N[d][1];var C=X.substr(0,L);var K=C.split("\n").length;E.row+=K-1;E.col=(1==K?M:0)+C.length-("\n"+C).lastIndexOf("\n");if("undefined"==typeof S[E.row]){S[E.row]=[]}var A=N[d][2].length;var W=N[d][3].length;X=X.substr(L+A);var P=N[d][0];var f=X.indexOf(N[d][3]);var F=X;var B=0;var V=false;while(0<f&&""!=N[d][4]&&N[d][4]==F.charAt(f-W)){V=true;B+=f+W;F=F.substr(f+W);f=F.indexOf(N[d][3])}if(V&&-1!=f){f+=B}if(-1==f){S[E.row].push([P,E.col,-1,""]);Z(P,E.row+1,-1);break}else{var D=X.substr(0,f);var b="\n"==N[d][3]?1:D.split("\n").length;var c=D.length-("\n"+D).lastIndexOf("\n");S[E.row].push([P,E.col,1==b?(E.col+f+A+W):-1,N[d][2]]);Z(P,E.row+1,E.row+b-1);if(1==b){M=E.col+f+A+W;if("\n"==N[d][3]){E.row++;M=0}}else{if("undefined"==typeof S[E.row+b]){S[E.row+b-1]=[]}S[E.row+b-1].push([P,-1,c+W,""]);M=c+W;E.row+=b-1}X=X.substr(f+W)}}delete N;delete X;var U=Math.max(S.length,this.syntax_map.length);for(i=0;i<U;i++){if("undefined"!=typeof S[i]){if("undefined"!=typeof this.syntax_map[i]){if(S[i].length==this.syntax_map[i].length){var H=false;for(var O=0;O<S[i].length;O++){if(S[i][O].length!=this.syntax_map[i][O].length){H=true;break}if(S[i][O][0]!=this.syntax_map[i][O][0]||S[i][O][1]!=this.syntax_map[i][O][1]||S[i][O][2]!=this.syntax_map[i][O][2]||S[i][O][3]!=this.syntax_map[i][O][3]){H=true;break}}if(!H){continue}}}this.syntax_map[i]=S[i]}else{if("undefined"!=typeof this.syntax_map[i]){delete this.syntax_map[i]}else{continue}}for(var O=0;O<this.views.length;O++){if(this.row_id_map[O]&&this.row_id_map[O][i]){this.row_id_map[O][i][1]=false}}}delete S;delete Z};ac.chap.Window.prototype.expandFolding=function(C){var B=this.views.length;for(var A=0;A<B;A++){this.views[A].expandFolding(C)}};ac.chap.Window.prototype.insertIntoCharacterMap=function(B,E,M,C,H){if($notset(E)){E=this.caret.position[0]}if($notset(M)){M=this.caret.position[1]}H=H|this.userId;if(!C&&!this.state.transactionLogStopped){this.transaction_log.push(ac.chap.TRANSLOG_TYPE_INSERT);this.transaction_log.push([E,M,H]);this.transaction_log.push(B)}var K=this.char_map.length;var D=B.split("\n");var O=D.length;var J=this.views.length;if(this.hasTransactionListener()){var I=this;setTimeout(function(){I.state.transactionListener[0](I,ac.chap.TRANSLOG_TYPE_INSERT,H,E,M,K,O,B);I=null},this.state.transactionListener[1])}var G=ii=0;if("undefined"==typeof this.char_map[E]){this.char_map=this.char_map.concat(D);for(G=0;G<O;G++){for(ii=0;ii<J;ii++){this.row_id_map[ii][E+G]=[this.row_id_sequence,false,ac.chap.ROWSTATE_NONE,[],[],[]]}this.row_id_sequence++}}else{if(this.char_map[E].length<M){M=this.char_map[E].length}for(G=0;G<J;G++){this.row_id_map[G][E][1]=false}if(1==O){this.char_map[E]=this.char_map[E].substr(0,M)+D[0]+this.char_map[E].substr(M)}else{var N=this.char_map[E].substr(M);this.char_map[E]=this.char_map[E].substr(0,M)+D[0];var A=E+(O-1);this.char_map=[].concat(this.char_map.slice(0,E+1),D.slice(1),this.char_map.slice(E+1));var L=[];var F=this.row_id_sequence;for(G=0;G<J;G++){L[G]=[];F=this.row_id_sequence;for(ii=1;ii<O;ii++){L[G][ii-1]=[F++,false,ac.chap.ROWSTATE_NONE,[],[],[]]}}this.row_id_sequence=F;for(G=0;G<J;G++){this.row_id_map[G]=[].concat(this.row_id_map[G].slice(0,E+1),L[G],this.row_id_map[G].slice(E+1))}this.char_map[A]+=N;for(G=0;G<J;G++){this.row_id_map[G][A][1]=false}}}if(1<O){for(G=0;G<J;G++){this.views[G].numVisibleRows+=(O-1)}}};ac.chap.Window.prototype.removeFromCharacterMap=function(J,B,D,G,C,F){if("undefined"==typeof D){D=J;G=B+1}F=F|this.userId;var A="";var E=0;var I=this.views.length;if(J==D){A=this.char_map[J].substring(B,G);this.char_map[J]=this.char_map[J].substr(0,B)+this.char_map[J].substr(G);for(E=0;E<I;E++){this.row_id_map[E][J][1]=false}}else{A=this.char_map[J].substr(B)+"\n"+this.char_map.slice(J+1,D).join("\n")+"\n"+this.char_map[D].substr(0,G);this.char_map[J]=this.char_map[J].substr(0,B)+this.char_map[D].substr(G);this.char_map=[].concat(this.char_map.slice(0,J+1),this.char_map.slice(D+1));for(E=0;E<I;E++){this.row_id_map[E][J][1]=false;this.row_id_map[E]=[].concat(this.row_id_map[E].slice(0,J),this.row_id_map[E].slice(D));if(J<this.row_id_map[E].length-1){this.row_id_map[E][J+1][1]=false}this.views[E].numVisibleRows-=(D-J)}}if(!C&&!this.state.transactionLogStopped){this.transaction_log.push(ac.chap.TRANSLOG_TYPE_REMOVE);this.transaction_log.push([J,B,D,G,F|this.userId]);this.transaction_log.push(A)}if(this.hasTransactionListener()){var H=this;setTimeout(function(){H.state.transactionListener[0](H,ac.chap.TRANSLOG_TYPE_REMOVE,F,J,B,D,G,A);H=null},this.state.transactionListener[1])}return A};if("undefined"==typeof ac){var ac={chap:{}}}$class("ac.chap.View",{construct:function(C,B,A){this.window=C;this.index=B;this.nodeScrollArea=null;this.nodeFillArea=null;this.nodeEditArea=null;this.nodeEditAreaCache=null;this.nodeCaret=null;this.nodeCaretRow=null;this.renderingRunning=false;this.numRows=0;this.numCols=0;this.wrapWidth=0;this.wrapHeight=0;this.startRow=0;this.startCol=0;this.startRowOffset=0;this.numVisibleRows=0;this.state={lastCaretPosition:[-1,-1],lastCaretRenderedPosition:null};this.theme=null;this.setOptions(A)},destruct:function(){clearInterval(this.caretAnimInterval);$delete(this.options);$delete(this.theme)}});ac.chap.View.prototype.setOptions=function(A){this.options={tabelator:"  ",wordWrap:false,colWidth:0,rowHeight:0,caretThreadTimeout:450};if($isset(A.wordWrap)){this.options.wordWrap=A.wordWrap}if($isset(A.tabelator)){this.options.tabelator=A.tabelator}this.calculateColRowDim();if($isset(A.theme)){this.theme=$new(A.theme)}else{this.theme=$new(ac.chap.Theme)}};ac.chap.View.prototype.calculateColRowDim=function(){var A=this.window.options.font.size;var C=$().a($$("span")).s("font:?px ?".embed(A,this.window.options.font.family)).t("a");this.options.colWidth=C.$.offsetWidth;C.rs();this.options.rowHeight=A+Math.ceil(A/10);var B=document.createElement("pre");B.style.minHeight=this.options.rowHeight+"px";B.style.font=this.window.options.font.size+"px "+this.window.options.font.family;B.style.lineHeight=this.options.rowHeight+"px";B.style.margin=0;B.style.padding=0;B.style.border=0;this.options.rowTemplate=B};ac.chap.View.prototype.setTheme=function(A){this.theme=$new(A);this.nodeRoot.s("background:?".embed(this.theme.background));this.nodeScrollArea.fc().s("background:?".embed(this.theme.background));$(this.nodeEditArea).s("color:?".embed(this.theme.textColor));this.renderText(true)};ac.chap.View.prototype.getSyntaxHighlightingSource=function(){function D(I){var F="";var J=I.childNodes;for(var H=0;H<J.length;H++){var G=J.item(H);if(3==G.nodeType){F+=G.data}else{if(1==G.nodeType){F+='<span style="color:?;background:?;font-style:?;font-weight:?;text-decoration:?;">'.embed(G.style.color,G.style.background,G.style.fontStyle,G.style.fontWeight,G.style.textDecoration)+D(G)+"</span>"}}}return F}var A=this.nodeEditArea.childNodes;var B="";for(var C=0;C<A.length;C++){var E=A.item(C);if(1!=E.nodeType&&"pre"!=node.tagName.toLowerCase()){continue}B+='<pre style="min-height=?">?</pre>'.embed(E.style.minHeight,D(E))}return B};function ch_encode_markup(A){if(-1!=A.indexOf("&")){A=A.replace(/&/g,"&amp;")}if(-1!=A.indexOf(">")){A=A.replace(/>/g,"&gt;")}if(-1!=A.indexOf("<")){A=A.replace(/</g,"&lt;")}return A}function ch_encode_markup_spaces(B){var C=B.length-B.replace(/ /g,"").length;for(var A=0;A<C;A++){B=B.replace(/([^ ]*) /i,function(){var D=-1!=arguments[1].indexOf("<");D=D&&(arguments[1].replace(/</g,"").length!=arguments[1].replace(/>/g,"").length);return arguments[1]+(D?"~`~`~`~`":"&nbsp;")})}return B.replace(/~`~`~`~`/g," ")}ac.chap.View.prototype.getRenderedCharDimension=function(B,A){return[this.options.colWidth,this.options.rowHeight]};ac.chap.View.prototype.getRenderedStringDimension=function(F,B,D){if("undefined"!=typeof this.window.char_map[F]){if(B<this.window.char_map[F].length){var E=this.window.char_map[F].substr(B,D);var A=0;var C=this.options.tabelator;while(-1!=A){A=E.indexOf("\t");if(-1!=A){E=E.substr(0,A)+C.substr(0,C.length-(A%C.length))+E.substr(A+1)}}return[this.options.colWidth*E.length,this.options.rowHeight]}}return[0,0]};ac.chap.View.prototype.getVirtualStringDimension=function(F,B,D){if(B<F.length){var E=F.substr(B,D);var A=0;var C=this.options.tabelator;while(-1!=A){A=E.indexOf("\t");if(-1!=A){E=E.substr(0,A)+C.substr(0,C.length-(A%C.length))+E.substr(A+1)}}return[this.options.colWidth*E.length,this.options.rowHeight]}return[0,0]};ac.chap.View.prototype.getRenderedCharPosition=function(G,B){var F=this.getRowNode(G);if(null!=F&&null!=F.parentNode){var D=this.getRenderedStringDimension(G,0,B)[0];var C=0;var E=this.getRenderedCharDimension(G,B);D-=E[0];if(this.options.wordWrap){if(0<B){var A=this.options.colWidth*(this.numCols);C=this.options.rowHeight*(Math.floor(D/A));D=(D)%A}}return[D,F.offsetTop+C,F]}return null};ac.chap.View.prototype.getRowNode=function(A){return document.getElementById("row-"+this.window.instanceId+"-"+this.index+"-"+A)};ac.chap.View.prototype.getVirtualCharPosition=function(F,G,B){var D=this.getVirtualStringDimension(G,0,B)[0];var C=0;var E=this.getRenderedCharDimension(0,B);D-=E[0];if(this.options.wordWrap){if(0<B){var A=this.options.colWidth*(this.numCols);C=this.options.rowHeight*(Math.floor(D/A));D=(D)%A}}return[D,F.offsetTop+C]};ac.chap.View.prototype.showCaret=function(A){var F=this.window.caret.position[0];var B=this.window.caret.position[1];pos=this.getRenderedCharPosition(F,B);if(null!=pos){var E=pos[2];var C=document.getElementById("ac-chap-caret-"+this.window.instanceId);if(null!=C){C.parentNode.removeChild(C)}if(1==this.window.state.caretPhase){C=document.createElement("div");C.id="ac-chap-caret-"+this.window.instanceId;C.style.position="absolute";C.style.font="1px arial";C.style.width=this.options.colWidth+"px";C.style.height=this.options.rowHeight+"px";pos[2]=this.options.colWidth;pos[3]=this.options.rowHeight;pos=this.theme.adjustCaretPosition(this.window.caret.mode,pos);C.style.left=pos[0]+"px";C.style.top=pos[1]+"px";this.theme.renderCaret(this.window.caret.mode,C);this.nodeCaret=E.appendChild(C);E.style.background=this.theme.caretRowStyleActive;if(!A){if(0>E.offsetTop-(this.nodeScrollArea.$.scrollTop%this.options.rowHeight)){this.scrollToRow(F)}else{if(E.offsetTop>this.options.rowHeight*(this.numRows-1)-$__tune.ui.scrollbarWidth){this.scrollToRow(F-Math.floor(this.numRows/2))}}}this.nodeCaretRow=E}if("undefined"!=typeof this.state.lastCaretRowIndex&&this.state.lastCaretRowIndex!=F){var D=this.getRowNode(this.state.lastCaretRowIndex);if(D){D.style.background="transparent"}}this.state.lastCaretRowIndex=F}else{if(!A){this.scrollToRow(F-Math.floor(this.numRows/2))}}};ac.chap.View.prototype.hideCaret=function(A){if(null!=this.nodeCaret&&null!=this.nodeCaret.parentNode){this.nodeCaret.parentNode.removeChild(this.nodeCaret);this.nodeCaret=null}if(!A&&null!=this.nodeCaretRow){this.nodeCaretRow.style.background="transparent"}};ac.chap.View.prototype.scrollToRow=function(C,A,B){this.nodeScrollArea.$.scrollTop=this.options.rowHeight*C-Math.floor(this.nodeRoot.$.offsetHeight/3);if(A){this.window.runAction(ac.chap.ACTION_CARET,{moveTo:[C,0]});this.window.runAction(ac.chap.ACTION_CARET,{move:"row_end"})}if(!B){this.window.state.caretPhase=1;this.showCaret(true)}};ac.chap.View.prototype.expandFolding=function(E){if("undefined"==typeof this.window.row_id_map[this.index][E]){return }var D=this.window.row_id_map[this.index][E][2];if(0==(ac.chap.ROWSTATE_FOLD_EXPAND&D)){return }var C=this.window.row_id_map[this.index][E][3][1];this.window.row_id_map[this.index][E][2]&=(65535-ac.chap.ROWSTATE_FOLD_EXPAND);this.window.row_id_map[this.index][E][1]=false;for(var A=E+1;A<=C;A++){this.window.row_id_map[this.index][A][1]=false;this.window.row_id_map[this.index][A][2]&=(65535-ac.chap.ROWSTATE_FOLD_COLLAPSED)}this.recalculateVisibleRows();var B=this;$runafter(40,function(){B.renderText(true)})};ac.chap.View.prototype.resize=function(){var A=this.nodeRoot.p().h();this.nodeRoot.h(A);$(this.nodeSidebar).h(A);this.nodeScrollArea.h(A);this.nodeFillArea.h(A-$__tune.ui.scrollbarWidth);$(this.nodeSelectionArea).h(A-$__tune.ui.scrollbarWidth+this.options.rowHeight);this.recalculateNumRows();this.recalculateVisibleRows();this.renderText(true)};ac.chap.View.prototype.reloadOptions=function(){this.calculateColRowDim();this.recalculateNumCols(false,true);this.recalculateNumRows();this.recalculateVisibleRows();this.renderSidebarStub();this.renderText(true)};ac.chap.View.prototype.recalculateNumCols=function(B,C){B=B||this.nodeRoot;var A=B.$.offsetWidth;if(C){A-=$__tune.ui.scrollbarWidth+61}this.numCols=Math.floor(A/this.options.colWidth)};ac.chap.View.prototype.recalculateNumRows=function(A){A=A||this.nodeRoot;this.numRows=Math.floor(A.$.offsetHeight/this.options.rowHeight)};ac.chap.View.prototype.showInteractiveSearch=function(){this.hideInteractiveSearch();var H=this.nodeRoot.abspos();var B=$().a($$()).pos(true).x(H.x+58).y(H.y).z(2000).w(this.nodeRoot.w()-$__tune.ui.scrollbarWidth-61).h(24).o(0.8);B.s("background:#000;border:1px solid #777;border-top:0;");var F="is_key_?".embed(this.window.ident);var J='<table align="right" cellpadding="0" cellspacing="0" style="height:24px"><tbody><tr><td width="96%" align="right" valign="middle" style="padding-right:20px;color:#fff"></td><td valign="middle" width="2%"><input type="text" onfocus="fry.keyboard.stop()" onblur="fry.keyboard.start()" id="'+F+'" style="height:12px;padding:1px;padding-left:3px;border:1px solid #777"/></td><td valign="middle"><img src="/mm/i/theme/apple/tabpane.button.close_invert.gif" width="14" height="14" title="Close" style="margin-left:4px;margin-right:4px"/></td></tr></tbody></table>';B.t(J);var G=this;var D=B.g("td:0");var C=B.g("input:0");var L=[G.window.caret.position[0],G.window.caret.position[1]];var A="";var K=G.window.getSelection();C.e("keydown",function(N){N.stopPropagation();if(40==N.keyCode){G.window.runAction(ac.chap.ACTION_CUSTOM,{action:"SearchKeyword",direction:"down"});G.scrollToRow(G.window.caret.position[0],false,true);G.window.processActionResult(true,true);N.preventDefault();return true}else{if(38==N.keyCode){G.window.runAction(ac.chap.ACTION_CUSTOM,{action:"SearchKeyword",direction:"up"});G.scrollToRow(G.window.caret.position[0],false,true);G.window.processActionResult(true,true);N.preventDefault();return true}else{if(27==N.keyCode){I(true);N.preventDefault();return true}else{if(13==N.keyCode){I();N.preventDefault();return true}}}}}).e("keyup",function(N){N.stopPropagation();M()}).$.focus();B.g("img:0").e("click",function(N){N.stopPropagation();I(true)});function I(N){if(N){G.window.removeSelection();G.window.runAction(ac.chap.ACTION_CARET,{moveTo:[L[0],L[1]]});G.scrollToRow(G.window.caret.position[0],false,true);G.window.processActionResult(true,true)}ac.chap.setActiveComponent(G.window);G.hideInteractiveSearch()}function E(N){D.t("Found <strong>?</strong> results.".embed(N))}function M(){var N=C.$.value.trim();if(""==N||A==N){if(""==N){E(0)}return }E(G.window.getText().split(N).length-1);A=N;G.window.removeSelection();G.window.runAction(ac.chap.ACTION_CARET,{moveTo:[L[0],L[1]]});G.window.runAction(ac.chap.ACTION_CUSTOM,{action:"SetSearchKeyword",keyword:N});G.window.runAction(ac.chap.ACTION_CUSTOM,{action:"SearchKeyword",direction:"down"});G.scrollToRow(G.window.caret.position[0],false,true);G.window.processActionResult(true,true)}if(null!=K){C.$.value=K;C.$.select();C.$.focus();M()}this.interactiveSearchNode=B};ac.chap.View.prototype.hideInteractiveSearch=function(){if(this.interactiveSearchNode&&this.interactiveSearchNode.is()){this.interactiveSearchNode.rs()}};ac.chap.View.prototype.render=function(D){var A=D.$.offsetWidth;var B=D.$.offsetHeight;this.recalculateNumRows(D);this.recalculateNumCols(D);D.sa("chap-view","true");var C=this;this.nodeRoot=D.a($$()).pos(true).w(A).h(B).n("acw-chap").s("background:?".embed(this.theme.background));this.interactiveSearchNode=null;var E=58;A-=E;this.nodeSidebar=this.nodeRoot.a($$()).pos(true).x(0).y(0).w(E).h(B).s("overflow:hidden").n("sidebar");this.renderSidebarStub();this.nodeScrollArea=this.nodeRoot.a($$()).pos(true).x(E).y(0).w(A).h(B).n("scroll-area").s("overflow:auto");this.nodeScrollArea.e("scroll",function(F){var J=Math.floor(C.nodeScrollArea.$.scrollTop/C.options.rowHeight);var I=C.window.row_id_map[C.index];var H=0;for(var G=0;G<I.length;G++){if(H==J){H=G;break}if(ac.chap.ROWSTATE_FOLD_EXPAND==(ac.chap.ROWSTATE_FOLD_EXPAND&I[G][2])){G=I[G][3][3]}H++}C.startRow=H;C.startRowOffset=J;if(C==C.window.activeView){C.hideCaret()}C.renderText();if(C==C.window.activeView&&C.startRow<C.window.caret.position[0]){if(null==C.window.selection){C.showCaret(true)}}});B-=$__tune.ui.scrollbarWidth;A-=$__tune.ui.scrollbarWidth+3;this.wrapWidth=A;this.wrapHeight=B;this.numCols=Math.floor(A/this.options.colWidth);this.nodeFillArea=this.nodeScrollArea.a($$()).pos(true).x(3).y(0).h(B).w((this.options.wordWrap?A:2000)-3).n("fill-area").s("overflow:hidden;background:?".embed(this.theme.background));this.editAreaWidth=A;this.editAreaHeight=B;this.nodeSelectionArea=this.nodeFillArea.a($$()).pos(true).x(0).w(this.nodeFillArea.w()).y(0).h(B+this.options.rowHeight).n("selection-area").s("overflow:hidden").$;this.nodeEditArea=this.nodeFillArea.a($$()).pos(true).x(0).y(0).h(B+this.options.rowHeight).n("edit-area").s("overflow:hidden; color:?".embed(this.theme.textColor)).e("click",function(F){C.window.captureEditAreaClick(F,C)}).$;this.nodeEditAreaCache=D.a($$()).pos(true).x(-700).y(-1700).w(300).h(500).v(false).s("overflow:hidden").$};ac.chap.View.prototype.renderSidebarStub=function(){var D=this.nodeRoot;var F=D.$.offsetHeight;var C=58;this.nodeSidebar=$(this.nodeSidebar).rc();var I=this.nodeSidebar.a($$()).pos(true).w(C).h(F).x(0).y(0).s("overflow:hidden");var G=0;var B=Math.max(1,Math.floor(this.options.rowHeight-11)/2);var H=this;for(var E=0;E<=this.numRows;E++){var A=I.a($$()).w(C).h(this.options.rowHeight).a($$()).pos(true).x(10).w(30).s("text-align:right;font-size:?px;color:#999;".embed(this.window.options.font.size-2));A.a($$("span")).s("font-size:?px;padding-top:1px".embed(this.window.options.font.size-2));A.a($$()).pos(true).x(-8).y(B).w(11).h(11).n("void").e("click",function(J){J.stop();var K=parseInt(J.$.p().ga("row-index"));H.window.toggleBookmark(K);$runafter(100,function(){H.window.renderText()})});A.a($$()).pos(true).x(34).y(B-1).w(12).h(11).n("void").e("click",function(J){J.stop();var M=parseInt(J.$.p().ga("row-index"));for(var K=0;K<H.window.views.length;K++){if("undefined"==typeof H.window.row_id_map[K][M]){return }var O=H.window.row_id_map[K][M][2];if(ac.chap.ROWSTATE_FOLD_EXPAND==(O&ac.chap.ROWSTATE_FOLD_EXPAND)){H.window.views[K].expandFolding(M)}else{if(ac.chap.ROWSTATE_FOLD_STOP==(O&ac.chap.ROWSTATE_FOLD_STOP)){M=H.window.row_id_map[K][M][3][1]}var N=H.window.row_id_map[K][M][3][1];H.window.row_id_map[K][M][2]|=ac.chap.ROWSTATE_FOLD_EXPAND;for(var L=M;L<=N;L++){H.window.row_id_map[K][L][1]=false;if(L!=M){if(0==(H.window.row_id_map[K][L][2]&ac.chap.ROWSTATE_FOLD_COLLAPSED)){H.window.row_id_map[K][L][2]|=ac.chap.ROWSTATE_FOLD_COLLAPSED}}}H.window.views[K].recalculateVisibleRows()}}$runafter(100,function(){H.window.renderText(true)})});G+=this.options.rowHeight}this.nodeSidebar=this.nodeSidebar.$};ac.chap.View.prototype.renderChunk=function(M){var L=[];var B=this.window.language.chunkRules.length;if(this.window.options.syntaxHighlightingEnabled){for(var G=0;G<B;G++){var D=true;var H=0;var N=M;var P=this.window.language.chunkRules[G][0];var K=this.window.language.chunkRules[G][1];var J=this.window.language.chunkRules[G][2];var A=200;while(""!=N&&null!=D){if(0==A--){console.warn("Error in RegExp definition (chunk): %s for: %s.",P,N);break}D=P.exec(N);if(null!=D){if(!D[K]){console.warn("Error in RegExp definition (invalid result index: %i): %s for: %s",K,P,N);continue}var I=D.index+D[0].indexOf(D[K]);L[H+I]=[J,D[K]];H+=I+D[K].length;N=N.substr(I+D[K].length)}}}}B=L.length;var C=";font:"+this.window.options.font.size+"px "+this.window.options.font.family;if(0<B){var O="";var F=0;for(G=0;G<B;G++){if("undefined"==typeof L[G]||""==L[G][1]){continue}var E=L[G];O+=ch_encode_markup(M.substr(F,G-F));if(this.theme.colorScheme[E[0]]){O+='<span style="'+this.theme.colorScheme[E[0]]+C+'">'+ch_encode_markup(E[1])+"</span>"}else{O+=ch_encode_markup(E[1])}G+=E[1].length-1;F=G+1}O+=ch_encode_markup(M.substr(F));M=O}else{M=ch_encode_markup(M)}return M};ac.chap.View.prototype.renderTextRow=function(Y,M,d){var H=this.window.char_map[M];var Z="";var G=0;var N=";font:"+this.window.options.font.size+"px "+this.window.options.font.family;var R=this.window.language.stringInterpolation;var K=this.window.row_id_map[this.index][M][2];if("undefined"!=typeof this.window.syntax_map[M]&&0<this.window.syntax_map[M].length){var W=this.window.syntax_map[M].length;for(var e=0;e<W;e++){var D=this.window.syntax_map[M][e];var S=D[0];var A=D[1];if(-1==A){A=0}var f=D[2];Z+=this.renderChunk(H.substr(G,A-G));var O=-1==f?H.substr(A):H.substr(A,f-A);if(this.theme.colorScheme[S]){if(R&&ac.chap.TOKEN_DOUBLE_QUOTED==S){var V=new RegExp(R[0],"i");var X=null;var F="";while(true){X=V.exec(O);if(!X){break}F+='<span style="'+this.theme.colorScheme[S]+N+'">'+ch_encode_markup(O.substring(0,X.index))+"</span>";F+=this.renderChunk(O.substr(X.index,X[R[1]].length));O=O.substr(X.index+X[R[1]].length)}F+='<span style="'+this.theme.colorScheme[S]+N+'">'+ch_encode_markup(O)+"</span>";Z+=F}else{Z+='<span style="'+this.theme.colorScheme[S]+N+'">'+ch_encode_markup(O)+"</span>"}}else{Z+=ch_encode_markup(O)}G=-1==f?H.length:f}}Z+=this.renderChunk(H.substr(G));if(false&&ac.chap.ROWSTATE_SELECTION==(K&ac.chap.ROWSTATE_SELECTION)){var U=this.window.row_id_map[this.index][M][5];if(0==U[0]&&this.window.char_map[M].length==U[1]){Z='<span style="width:auto;display:block;'+(""==Z?("height:"+this.options.rowHeight+"px;"):"")+this.theme.selectionStyle+'">'+Z+"</span>"}else{var T=Z;var W=T.length;var Q=0;var J=false;var G=0;for(var e=0;e<W;e++){var P=T.charAt(e);if("<"==P){if(J){var h="</span>";Z=Z.substr(0,e+G)+h+Z.substr(e+G);G+=h.length}var E=T.substr(e).indexOf(">");e+=E;if(J){var h='<span style="'+this.theme.selectionStyle+'">';Z=Z.substr(0,e+G+1)+h+Z.substr(e+G+1);G+=h.length}continue}if(U[0]==Q){J=true;var h='<span style="'+this.theme.selectionStyle+'">';Z=Z.substr(0,e+G)+h+Z.substr(e+G);G+=h.length}if(J&&U[1]-1<Q){J=false;var h="</span>";Z=Z.substr(0,e+G)+h+Z.substr(e+G);break}if("&"==P){if("&lt;"==T.substr(e,4)||"&gt;"==T.substr(e,4)){e+=3}else{if("&amp;"==T.substr(e,5)){e+=4}}}Q++}if(J){Z+="</span>"}}}var E=0;var C=this.options.tabelator;var T=this.window.char_map[M];var g=[];while(-1!=E){E=T.indexOf("\t");if(-1!=E){var B=C.length-(E%C.length);T=T.substr(0,E)+C.substr(0,B)+T.substr(E+1);g.push(B)}}for(var e=0;e<g.length;e++){Z=Z.replace(/\t/,C.substr(0,g[e]))}var b=1;if(this.options.wordWrap&&this.numCols<T.length){var T=Z;var I="";var W=Z.length;var G=1;for(e=0;e<W;e++){var P=Z.charAt(e);if("<"==P&&"b"!=Z.charAt(e+1)){E=Z.substr(e).indexOf(">");if(-1==E){break}e+=E;continue}var L=0;if("&"==P){if("&lt;"==Z.substr(e,4)||"&gt;"==Z.substr(e,4)){L=3}else{if("&amp;"==Z.substr(e,5)){L=4}}}I+=P.charAt(0);if(this.numCols==I.length){T=T.substr(0,e+G+L)+"<br>"+T.substr(e+G+L);b++;G+=4;I=""}e+=L}Z=T}if(ac.chap.ROWSTATE_FOLD_EXPAND==(K&ac.chap.ROWSTATE_FOLD_EXPAND)){var j=this.window.row_id_map[this.index][M][3][1];var a=ch_encode_markup(this.window.char_map.slice(M,j+1).join("\n").replace(/"/ig,"''"));Z+="<a href=\"javascript:ac.chap.route('expand-folding', 'window-id', "+this.index+", "+M+')"><div class="folding-expand-inner" style="position:absolute" title="?"></div></a>'.embed(a)}Y.setAttribute("num-subrows",b);if($__tune.isIE){Z=ch_encode_markup_spaces(Z)}Y.innerHTML=Z};ac.chap.View.prototype.recalculateVisibleRows=function(){var D=this.window.row_id_map[this.index];var E=D.length;var A=0;var B=0;while(A<E){var C=D[A][2];if(0==(ac.chap.ROWSTATE_FOLD_COLLAPSED&C)){B++}A++}this.numVisibleRows=B};ac.chap.View.prototype.getVisibleRowIndices=function(){var E=this.window.row_id_map[this.index];var C=0;var B=this.startRow;var F=[];while(C++<=this.numRows){if("undefined"==typeof this.window.row_id_map[this.index][B]){break}var D=this.window.row_id_map[this.index][B][2];if(ac.chap.ROWSTATE_FOLD_COLLAPSED==(ac.chap.ROWSTATE_FOLD_COLLAPSED&D)){C--;B++;continue}F.push(B);if(ac.chap.ROWSTATE_FOLD_EXPAND==(D&ac.chap.ROWSTATE_FOLD_EXPAND)){var A=this.window.row_id_map[this.index][B][3][1];B=A+1}else{B++}}return F};ac.chap.View.prototype.renderRowSidebar=function(H,K,E,A){if(!this.nodeSidebar.firstChild.childNodes.item(H)){return }var B=this.nodeSidebar.firstChild.childNodes.item(H).firstChild;if(0==E.offsetHeight){E.style.height=this.options.rowHeight}var C=parseInt(E.getAttribute("num-subrows"));var I=A?"none":(C+":"+this.window.row_id_map[this.index][K].join("-"));if(B.getAttribute("sidebar-cache-id")==I&&"none"!=I){return }if("none"!=I){B.setAttribute("sidebar-cache-id",I);B.firstChild.style.fontSize=(this.window.options.font.size-2)+"px"}var M=C*this.options.rowHeight;B.parentNode.style.height=M+"px";if(A){B.firstChild.style.fontSize=(this.window.options.font.size-2)+"px"}var L=K+1;if(this.options.wordWrap){var F='<div style="height:'+this.options.rowHeight+'px;" class="wrapped-row"></div>';for(var G=1;G<C;G++){L+=F}}B.firstChild.innerHTML=L;B.setAttribute("row-index",K);var D=this.window.row_id_map[this.index][K][2];var J=(ac.chap.ROWSTATE_FOLD_START==(D&ac.chap.ROWSTATE_FOLD_START))||(ac.chap.ROWSTATE_FOLD_STOP==(D&ac.chap.ROWSTATE_FOLD_STOP));if(!J){B.lastChild.className="void"}else{B.lastChild.style.display="block";if(ac.chap.ROWSTATE_FOLD_EXPAND==(D&ac.chap.ROWSTATE_FOLD_EXPAND)){B.lastChild.className="folding-expand"}else{if(ac.chap.ROWSTATE_FOLD_START==(D&ac.chap.ROWSTATE_FOLD_START)){B.lastChild.className="folding-start"}if(ac.chap.ROWSTATE_FOLD_STOP==(D&ac.chap.ROWSTATE_FOLD_STOP)){B.lastChild.className="folding-stop"}}}if(ac.chap.ROWSTATE_BOOKMARK==(D&ac.chap.ROWSTATE_BOOKMARK)){B.firstChild.nextSibling.className="bookmark-default"}else{B.firstChild.nextSibling.className="void"}};ac.chap.View.prototype.renderSelection=function(){var C=this.getVisibleRowIndices();var P=C.length;var W=document.createElement("div");var B=this.options.tabelator;for(var O=0;O<P;O++){var L=C[O];if(!this.window.row_id_map[this.index][L]){continue}var J=this.window.row_id_map[this.index][L][2];if(ac.chap.ROWSTATE_SELECTION==(J&ac.chap.ROWSTATE_SELECTION)){var F=document.getElementById("row-"+this.window.instanceId+"-"+this.index+"-"+L);if(null==F){continue}var N=[this.window.row_id_map[this.index][L][5][0],this.window.row_id_map[this.index][L][5][1]];if(-1==N[1]){continue}var R=false;if(0==N[0]&&this.window.char_map[L].length==N[1]){R=(this.window.row_id_map[this.index][L+1]&&ac.chap.ROWSTATE_SELECTION==(this.window.row_id_map[this.index][L+1][2]&ac.chap.ROWSTATE_SELECTION))}var Q=N[0]+"-"+N[1];var V="rsel-"+this.window.instanceId+"-"+this.index+"-"+L;var I=document.getElementById(V);if(null!=I&&I.getAttribute("cachid")==Q){I.style.top=F.offsetTop+"px";W.appendChild(I)}else{I=W.appendChild(document.createElement("div"));I.id=V;I.style.background=this.theme.selectionStyle;I.style.position="absolute";I.style.top=F.offsetTop+"px";I.setAttribute("cachid",Q);I.style.height=this.options.rowHeight+"px";if(R){I.style.left="0px";I.style.width=F.offsetWidth+"px";I.style.height=F.offsetHeight+"px"}else{if(this.options.wordWrap){var S=this.window.char_map[L];var D=0;var U=0;var G=[0,-1,0,-1];for(var M=0;M<S.length;M++){var K=S.charAt(M);if(M==N[0]){G[0]=U;G[1]=D}if("\t"==K){var A=B.length-(D%B.length);D+=A}else{D++}if(D>this.numCols){U++;D-=this.numCols}if(M==N[1]){G[2]=U;G[3]=D;break}}if(-1==G[3]){G[2]=U+1}I.style.top=(F.offsetTop+this.options.rowHeight*G[0])+"px";if(G[0]==G[2]){I.style.left=G[1]*this.options.colWidth+"px";I.style.width=((G[3]-G[1])*this.options.colWidth)+"px"}else{if(-1==G[1]){I.style.left=(D*this.options.colWidth)+"px";I.style.width=(F.offsetWidth-(D*this.options.colWidth))+"px"}else{I.style.left=(G[1]*this.options.colWidth)+"px";I.style.width=(F.offsetWidth-(G[1]*this.options.colWidth))+"px"}I.removeAttribute("cachid");for(M=G[0]+1;M<=G[2];M++){I=W.appendChild(document.createElement("div"));I.style.background=this.theme.selectionStyle;I.style.position="absolute";I.style.left="0px";I.style.top=(F.offsetTop+M*this.options.rowHeight)+"px";I.style.height=this.options.rowHeight+"px";if(M!=G[2]){I.style.width=F.offsetWidth+"px"}else{I.style.width=((G[3])*this.options.colWidth)+"px"}}}}else{var H=this.getRenderedStringDimension(L,0,N[0])[0];var E=this.getRenderedStringDimension(L,0,N[1]+1)[0];I.style.left=H+"px";I.style.width=(E-H)+"px"}}}}}var T=W.innerHTML;this.nodeSelectionArea.innerHTML=T};ac.chap.View.prototype.renderText=function(A){var E=this.getVisibleRowIndices();var P=E.length;var M=-1;var K=-1;for(var I=0;I<P;I++){var L=E[I];if(!this.window.row_id_map[this.index][L][1]){if(-1==M){M=L;K=I}else{M=-2;break}}}var N=this.index+"-"+E.length+"-"+this.window.row_id_map[this.index][E[0]][0]+"-"+this.window.row_id_map[this.index][E[E.length-1]][0]+"-"+this.nodeScrollArea.$.scrollHeight+"-"+Math.floor(this.nodeScrollArea.$.scrollTop/this.options.rowHeight);var C=-2!=M&&(null!=this.nodeEditArea.getAttribute("last-scroll"))&&(this.nodeEditArea.getAttribute("last-scroll")==N);this.nodeEditArea.setAttribute("last-scroll",N);if(C&&0<=M){var G=document.getElementById("row-"+this.window.instanceId+"-"+this.index+"-"+M);if(null!=G&&null!=G.parentNode&&this.window.row_id_map[this.index][M][0]==G.getAttribute("row-id")){this.renderTextRow(G,M);if(""==G.innerHTML){G.style.height=this.options.rowHeight+"px"}else{G.style.height=null}this.renderRowSidebar(K,M,G);this.window.row_id_map[this.index][M][1]=true;C=true}}var J=-this.nodeScrollArea.$.scrollTop%this.options.rowHeight;var D=(this.options.wordWrap?this.wrapWidth:this.nodeFillArea.$.offsetWidth)+"px";if(A||!C){for(I=0;I<P;I++){var L=E[I];var H=!this.window.row_id_map[this.index][L][1];this.window.row_id_map[this.index][L][1]=true;var G=document.getElementById("row-"+this.window.instanceId+"-"+this.index+"-"+L);if(!H){H=(null==G)||(null==G.parentNode)||(G.getAttribute("row-id")!=this.window.row_id_map[this.index][L][0])}if(null==G||null==G.parentNode){H=true;G=this.options.rowTemplate.cloneNode(false);G.id="row-"+this.window.instanceId+"-"+this.index+"-"+L;G.style.width=D;G.setAttribute("row-index",L)}if(A||H){G.setAttribute("row-id",this.window.row_id_map[this.index][L][0]);if(A){G.style.minHeight=this.options.rowTemplate.style.minHeight;G.style.lineHeight=this.options.rowTemplate.style.lineHeight;G.style.font=this.options.rowTemplate.style.font}this.renderTextRow(G,L)}if(""==G.innerHTML){G.style.height=this.options.rowHeight+"px"}else{G.style.height=null}this.nodeEditAreaCache.appendChild(G);this.renderRowSidebar(I,L,G,A)}for(I=P;I<this.numRows;I++){if(this.nodeSidebar.firstChild.childNodes.item(I)&&this.nodeSidebar.firstChild.childNodes.item(I).firstChild){var B=this.nodeSidebar.firstChild.childNodes.item(I).firstChild;B.lastChild.className="void";B.firstChild.nextSibling.className="void";B.firstChild.innerHTML=""}}this.nodeEditArea.style.top=this.nodeSelectionArea.style.top=(this.startRowOffset*this.options.rowHeight)+"px";if($__tune.isSafari){this.nodeEditArea.innerHTML="";while(this.nodeEditAreaCache.firstChild){this.nodeEditArea.appendChild(this.nodeEditAreaCache.firstChild)}}else{var O=this.nodeEditAreaCache.innerHTML;this.nodeEditArea.innerHTML=O;this.nodeEditAreaCache.innerHTML=""}var F=(this.numVisibleRows+2)*this.options.rowHeight;if(this.nodeRoot.h()-$__tune.ui.scrollbarWidth>F){F=this.nodeRoot.h()-$__tune.ui.scrollbarWidth}this.nodeFillArea.h(F)}else{this.nodeEditAreaCache.innerHTML=""}if(parseInt(this.nodeSidebar.firstChild.style.top)!=J){this.nodeSidebar.firstChild.style.top=(J)+"px";this.nodeSidebar.firstChild.style.height=(this.nodeSidebar.offsetHeight-$__tune.ui.scrollbarWidth-J)+"px"}this.renderSelection()};if("undefined"==typeof ac){var ac={chap:{}}}$class("ac.chap.KeyMap",{construct:function(){this.definition={};this.isMac=true;this.wordCompleteCache=null;this.snippetCompleteCache=null;this.searchKeyword="";this.initDefinition()}});ac.chap.KeyMap.prototype.initDefinition=function(){};ac.chap.KeyMap.prototype.importCommands=function(A){var D=A.length;for(var B=0;B<D;B++){var C=A[B];if($isset(C.key_activation)){this.compile("KEY: ?\ncustom(action:'RunCommand', commandIndex:?)\n".embed(C.key_activation,B))}}};ac.chap.KeyMap.prototype.importSnippets=function(B){var D=B.length;for(var A=0;A<D;A++){var C=B[A];if($isset(C.key_activation)){this.compile("KEY: ?\ncustom(action:'RunSnippet', snippetIndex:?)\n".embed(C.key_activation,A))}}};ac.chap.KeyMap.prototype.action_NotDefined=function(D,F,A,C,B,E){console.warn("There is no custom action defined for key code: %s and control keys mask: %s.",D,F)};ac.chap.KeyMap.prototype.action_RunCommand=function(D,G,A,C,B,F){var E=$getdef(B.commands[F.commandIndex],null);if(null==E){console.warn("There is no command at index `%s`.",F.commandIndex);return }return B.runCommand(D,G,A,C,E,F)};ac.chap.KeyMap.prototype.action_RunSnippet=function(E,G,A,D,B,F){var C=$getdef(B.snippets[F.snippetIndex],null);if(null==C){console.warn("There is no snippet at index `%s`.",F.snippetIndex);return }return this.snippetInit(C,B,A,D,true)};ac.chap.KeyMap.prototype.action_RunVirtualSnippet=function(E,G,B,D,C,F){var A=this.snippetInit(F.snippet,C,B,D,true);return A};ac.chap.KeyMap.prototype.action_ToggleBookmark=function(D,F,A,C,B,E){B.toggleBookmark(A);$runafter(100,function(){B.renderText()});return 0};ac.chap.KeyMap.prototype.action_GoToBookmark=function(D,F,A,C,B,E){B.scrollToBookmark(A,E.direction);return 0};ac.chap.KeyMap.prototype.action_WordComplete=function(F,E,Q,N,J,O){if(!J.language.wordDelimiter.test(J.getCharAt(Q,N-1))){return }var I=this.wordCompleteCache;if(!I){I={position:[-1,-1],results:[],index:-1}}var B=false;if(I.position[0]!=Q||I.position[1]!=N){var D=300;var G=J.getWordAt(Q,N,-D-1);var H=J.getWordAt(Q,N,D);var A=G[0];var L=A.length;var K=[A];var P="";for(var M=0;M<D;M++){if(G[M+1]&&G[M+1].length>L&&G[M+1].substr(0,L)==A){if(-1==P.indexOf(" "+G[M+1])){K.push(G[M+1]);P+=" "+G[M+1]}}if(H[M]&&H[M].length>L&&H[M].substr(0,L)==A){if(-1==P.indexOf(" "+H[M])){K.push(H[M]);P+=" "+H[M]}}}if(1<K.length){I.results=K;I.index=0;B=true}}else{B=true}var R=I.results.length;if(B&&0<R){var C=I.index;C+=O.direction?1:-1;if(R<=C){C=0}else{if(0>C){C=R-1}}J.stopTransactionLog();J.runAction(ac.chap.ACTION_CARET,{move:"prev_word"});J.runAction(ac.chap.ACTION_SELECTION,{add:true});J.runAction(ac.chap.ACTION_DELETE,{character:false});J.runAction(ac.chap.ACTION_INSERT,{string:I.results[C]});J.startTransactionLog();I.index=C;I.position=[J.caret.position[0],J.caret.position[1]]}else{I.results=[]}this.wordCompleteCache=I;return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT};ac.chap.KeyMap.prototype.getAffectedRows=function(E,C){var D=C;var B=C;if(null!=E.selection){var A=E.selection.startPosition[0];var F=E.selection.endPosition[0];if(-1==E.selection.endPosition[1]){F--}D=Math.min(A,F);B=Math.max(A,F)}return[D,B]};ac.chap.KeyMap.prototype.action_Indent=function(J,A,G,I,H,D){var C=this.getAffectedRows(H,G);var B=H.getTabelator();for(var E=C[0];E<=C[1];E++){if("right"==D.direction){H.insertIntoCharacterMap(B,E,0)}else{var K=H.char_map[E];var F=0;while(("\t"==K.charAt(F)||" "==K.charAt(F))&&(K.length>F)&&(B.length>F)){F++}if(0<F){H.removeFromCharacterMap(E,0,E,F)}}}return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT|ac.chap.ACTION_RES_SELECTIONCHANGED};ac.chap.KeyMap.prototype.action_Comment=function(M,B,J,L,K,E){if(!K.language){return 0}var F=K.language.singleRowCommentStartMarkers;if(0==F.length){return 0}var H=F[0];var C=K.getTabelator();var D=this.getAffectedRows(K,J);var C=K.getTabelator();var A=H+" ";for(var G=D[0];G<=D[1];G++){var N=K.char_map[G];var I=N.indexOf(H);if(-1!=I&&0==N.substring(0,I).replace(C,"").replace(" ","")){K.removeFromCharacterMap(G,0,G,I+H.length)}else{K.insertIntoCharacterMap(H,G,0)}}return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT|ac.chap.ACTION_RES_SELECTIONCHANGED};ac.chap.KeyMap.prototype.action_RuntimeOption=function(D,F,A,C,B,E){B.setRuntimeOption(E.key,E.value);return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT|ac.chap.ACTION_RES_SELECTIONCHANGED};ac.chap.KeyMap.prototype.action_SearchInteractive=function(D,F,A,C,B,E){B.showInteractiveSearch();return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_SELECTIONCHANGED};ac.chap.KeyMap.prototype.action_SetSearchKeyword=function(D,F,A,C,B,E){if(E.keyword){this.searchKeyword=E.keyword;return 0}if(B.selection&&B.selection.startPosition[0]==B.selection.endPosition[0]){this.searchKeyword=B.getSelection();return ac.chap.ACTION_RES_SELECTIONCHANGED}return 0};ac.chap.KeyMap.prototype.action_SearchKeyword=function(I,B,F,H,G,C){if(""==this.searchKeyword){return 0}row_index=F;var E=0;var A="down"==C.direction;do{var J=G.char_map[row_index];var D=0;console.log(ac.chap.activeComponent.activeView);if(row_index==F){if(A){J=J.substr(H);D+=H}else{if(J.substring(H-this.searchKeyword.length,H)){D=this.searchKeyword.length}J=J.substring(0,H-D);D=0}}E=A?J.indexOf(this.searchKeyword):J.lastIndexOf(this.searchKeyword);if(-1!=E){E+=D;G.runAction(ac.chap.ACTION_SELECTION,{remove:true});G.runAction(ac.chap.ACTION_CARET,{moveTo:[row_index,E]});G.runAction(ac.chap.ACTION_CARET,{store:true});G.runAction(ac.chap.ACTION_CARET,{moveTo:[row_index,E+this.searchKeyword.length]});G.runAction(ac.chap.ACTION_SELECTION,{add:true});return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_SELECTIONCHANGED|ac.chap.ACTION_RES_SCROLLTOCARET}row_index+=A?1:-1;if(A&&row_index==G.char_map.length){row_index=0}else{if(!A&&-1==row_index){row_index=G.char_map.length-1}}}while(F!=row_index);return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_SELECTIONCHANGED};ac.chap.KeyMap.prototype.action_SmartIndent=function(J,B,G,I,H,D){var K=H.getLineAt(G);var C=D.indent_tab_when_ends?K.match(/^([ \t]*)(.*)$/):K.match(/^([ \t]*)([^ \t]*)/);var A=C[1];if(D.indent_tab_when_ends||D.indent_tab_when_starts){C[2]=C[2].trim();var F=D.indent_tab_when_ends?D.indent_tab_when_ends.split(" "):D.indent_tab_when_starts.split(" ");for(var E=0;E<F.length;E++){if((D.indent_tab_when_ends&&F[E]==C[2].substr(C[2].length-F[E].length))||(D.indent_tab_when_starts&&F[E]==C[2].substr(0,F[E].length))){A+=H.getTabelator();break}}}if(D.split_line){H.runAction(ac.chap.ACTION_INSERT,{row:true})}else{H.runAction(ac.chap.ACTION_CARET,{move:"row_end"});A=(D.set_char_at_end?D.set_char_at_end:"")+"\n"+A}H.runAction(ac.chap.ACTION_INSERT,{string:A});return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT};ac.chap.KeyMap.prototype.action_SmartUnindent=function(N,B,H,M,I,E){if(!E.starts_with){console.warn("Missing starts_with parameter for SmartUnindent.");return 0}if(!E.ends_with){console.warn("Missing ends_with parameter for SmartUnindent.");return 0}var Q=I.getLineAt(H);var L=E.starts_with.split(" ");var C=E.ends_with.split(" ");if(L.length!=C.length){console.warn("Non-matching start and end tokens for SmartUnindent.");return 0}var J=Q.trim()+String.fromCharCode(N);var G=false;for(var F=0;F<C.length;F++){if(C[F]==J){G=true;break}}var A=null;if(G){var P=H-1;var O=0;var K="end"==E.match_from;while(0<=P&&null==A){Q=I.getLineAt(P);var D=K?Q.match(/^([ \t]*)(.*)$/):Q.match(/([ \t]*)([^ \t]*)/);D[2]=D[2].trim();for(F=0;F<C.length;F++){if((K&&C[F]==D[2].substr(D[2].length-C[F].length))||(!K&&C[F]==D[2].substr(0,C[F].length))){O++;J=Q.trim();break}}for(F=0;F<L.length;F++){if((K&&L[F]==D[2].substr(D[2].length-L[F].length))||(!K&&L[F]==D[2].substr(0,L[F].length))){if(0==O){A=D[1]+J}O--;break}}P--}}if(null!=A){I.runAction(ac.chap.ACTION_CARET,{move:"row_start"});I.runAction(ac.chap.ACTION_SELECTION,{add:true});I.runAction(ac.chap.ACTION_DELETE,{"char":true});I.runAction(ac.chap.ACTION_INSERT,{string:A});I.runAction(ac.chap.ACTION_CARET,{move:"row_end"})}else{I.runAction(ac.chap.ACTION_INSERT,{string:String.fromCharCode(N)})}return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT};ac.chap.KeyMap.prototype.action_AutoComplete=function(E,H,A,D,B,G){var F=B.getSelection();var C=G.text;if(""!=F){B.runAction(ac.chap.ACTION_DELETE,{character:true});if(G.use_selection){C=F+G.text}}B.runAction(ac.chap.ACTION_INSERT,{string:String.fromCharCode(E)});B.runAction(ac.chap.ACTION_INSERT,{string:C,skipCaretChange:""==F});return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT};ac.chap.KeyMap.prototype.action_SnippetComplete=function(E,D,R,N,G,Q){var A=this.snippetCompleteCache;var L=null==A;var K=false;var C=null;if(L){if(null!=G.selection){C=""}else{if(G.language.wordDelimiter.test(G.getCharAt(R,N-1))){C=G.getWordAt(R,N,-1)}}}if(L&&null!=C){var O=G.snippets;var J=[];for(var M=0;M<O.length;M++){var F=O[M];if(F.tab_activation==C){J.push(F)}}if(0<J.length){return this.snippetInit(J[0],G,R,N,""==C,C)}}if(L){if(null!=A){G.removeActionListener(A.callbackIndex);G.removeSelection()}G.runAction(ac.chap.ACTION_INSERT,{string:"\t"})}else{G.removeActionListener(A.callbackIndex);G.removeSelection();if(0!=A.activeTabStopIndex){var H=false;for(var M=A.activeTabStopIndex+1;M<A.tabstops.length;M++){if(A.tabstops[M]){A.activeTabStopIndex=M;H=true;break}}if(!H){A.activeTabStopIndex=0}var I=A.tabstops[A.activeTabStopIndex];for(var P in A.tabstops){var B=A.tabstops[P]}G.runAction(ac.chap.ACTION_SELECTION,{remove:true});G.runAction(ac.chap.ACTION_CARET,{moveTo:A.insertCaretPosition});G.runAction(ac.chap.ACTION_CARET,{moveBy:"column",value:I[2]-(A.wasSelection?0:A.tabActivation.length)});if(""!=I[1]){G.runAction(ac.chap.ACTION_CARET,{store:true});G.runAction(ac.chap.ACTION_CARET,{moveBy:"column",value:I[1].length});G.runAction(ac.chap.ACTION_SELECTION,{add:true});K=true}if(0!=A.activeTabStopIndex){A.firstInitialized=true;A.callbackIndex=G.addActionListener(ac.chap.ACTION_LISTENER_BOTH,this,this.snippetCompleteActionListener)}else{A=null}this.snippetCompleteCache=A}}return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT|(K?ac.chap.ACTION_RES_SELECTIONCHANGED:0)};ac.chap.KeyMap.prototype.snippetInit=function(snippet,component,caretRow,caretCol,wasSelection,tabActivation){tabActivation=tabActivation||"";var code=snippet.code;var code_chunks=[];var re="";var m=[];var selection_changed=false;var indent_line=component.char_map[component.getCaretPosition()[0]];var indent_string=indent_line.match(/[\s]*/)[0];code=code.replace(/\n/g,"\n"+indent_string);code=code.replace(/\\\$/g,"\0");re=/(^|[^\\])(\${1,2})([a-zA-Z][\w_\-\+]*)/;while(true){m=re.exec(code);if(null==m){break}var is_escaped=2==m[2].length;var var_name=m[3];var value=component.getVariableValue(var_name);if(is_escaped){value=value.replace(/'/g,"\\'").replace(/\n/g,"\\n")}code=code.substr(0,m.index+m[1].length)+value+code.substr(m.index+m[0].length)}re=/(^|[^\\])(\${1,2})\{([a-zA-Z][\w_\-\+]*)\:([^\}]*)\}/;while(true){m=re.exec(code);if(null==m){break}var is_escaped=2==m[2].length;var var_name=m[3];var default_value=m[4];var value=component.getVariableValue(var_name,default_value);if(is_escaped){value=value.replace(/'/g,"\\'").replace(/\n/g,"\\n")}code=code.substr(0,m.index+m[1].length)+value+code.substr(m.index+m[0].length)}re=/(^|[^\\])(\${1,2})\{([a-zA-Z][\w_\-\+]*)\/([^\/]*)\/([^\/]*)\/([^\}]*)\}/;while(true){m=re.exec(code);if(null==m){break}var is_escaped=2==m[2].length;var var_name=m[3];var pattern=m[4];var replacement=m[5];var options=m[6];var value=component.getVariableValue(var_name);try{eval('value = value.replace(/?/?, "?");'.embed(pattern,options,replacement.replace(/"/g,'"')))}catch(e){console.error("Snippet runtime error. Regular transformation for variable `%s`, pattern `%s`, replacement `%s` and options `%s` failed. Error: `%s`.",var_name,pattern,replacement,options,e)}if(is_escaped){value=value.replace(/'/g,"\\'").replace(/\n/g,"\\n")}code=code.substr(0,m.index+m[1].length)+value+code.substr(m.index+m[0].length)}re=/(^|[^\\])(\${1,2})\{([a-zA-Z][\w_\-\+]*)\|([^\}]*)\}/;while(true){m=re.exec(code);if(null==m){break}var is_escaped=2==m[2].length;var var_name=m[3];var transformation=m[4];var value=component.getVariableValue(var_name);try{if("."==transformation.charAt(0)){eval("value = value?".embed(transformation))}else{eval("value = this.snippetTransform_?(value, component)".embed(transformation))}}catch(e){console.error("Snippet runtime error. Custom transformation for variable `%s` and transformation `%s` failed. Error: `%s`.",var_name,transformation,e)}if(is_escaped){value=value.replace(/'/g,"\\'").replace(/\n/g,"\\n")}code=code.substr(0,m.index+m[1].length)+value+code.substr(m.index+m[0].length)}if(wasSelection&&null!=component.selection){component.runAction(ac.chap.ACTION_DELETE,{character:false});caretRow=component.caret.position[0];caretCol=component.caret.position[1]}var execution_scheduled=false;re=/`(([^`]|\\`)*)`/;while(true){m=re.exec(code);if(null==m){break}var exec_code=m[1];var code_rows=exec_code.split("\n");if(1==code_rows){console.warn("Snippet definition error. Backstick code too short. You might be missing declaration or there is no code body. Further execution terminated. Source: `%s`",exec_code);break}var declaration=exec_code.split("\n")[0].trim();var body=code_rows.slice(1).join("\n");var output="";if("/local/javascript"==declaration){try{eval(body)}catch(e){console.error("Snippet runtime error. Backstick execution of local code for declaration `%s` and source code `%s` failed. Error: `%s`.",declaration,body,e);break}}else{if("/remote/post"==declaration){var action="";var params={};try{eval(body)}catch(e){console.error("Snippet runtime error #01. Backstick execution of remote code for declaration `%s` and source code `%s` failed. Error: `%s`.",declaration,body,e);break}params.a=action;$rpost(params,function(output){var v_snippet={};if(snippet.tab_activation){v_snippet.tab_activation=snippet.tab_activation}if(snippet.key_activation){v_snippet.key_activation=snippet.key_activation}v_snippet.code=code.substr(0,m.index)+output+code.substr(m.index+m[0].length);v_snippet.name=snippet.name;var result=component.runAction(ac.chap.ACTION_CUSTOM,{action:"RunVirtualSnippet",snippet:v_snippet});component.processActionResult(ac.chap.ACTION_RES_REDRAWTEXT==(result&ac.chap.ACTION_RES_REDRAWTEXT),ac.chap.ACTION_RES_REDRAWCARET==(result&ac.chap.ACTION_RES_REDRAWCARET));if(ac.chap.ACTION_RES_SELECTIONCHANGED==(result&ac.chap.ACTION_RES_SELECTIONCHANGED)){component.hideCaret()}},function(e){console.error("Snippet runtime error #02. Backstick execution of remote code for declaration `%s` and source code `%s` failed. Error: `%s`.",declaration,body,e)},"POST",ac.chap.activeComponent.options.remoteBackendURL);execution_scheduled=true;if(!wasSelection){component.runAction(ac.chap.ACTION_CARET,{move:"prev_word"});component.runAction(ac.chap.ACTION_SELECTION,{add:true});component.runAction(ac.chap.ACTION_DELETE,{character:true})}break}}code=code.substr(0,m.index)+output+code.substr(m.index+m[0].length)}if(!execution_scheduled){var tabstops=[];re=/(^|[^\\\{])\$\{(\d)\:([^\}\{]*)\}/;var any_change=true;var tab_id=0;while(any_change){any_change=false;code_chunks=[];while(true){m=re.exec(code);if(null!=m){if(m[0]){var start_ix=m.index+m[1].length}tab_id=m[2];tabstops[tab_id]=["ph",m[3],-1,-1];code_chunks.push(code.substr(0,start_ix)+"#<CHAP_PLACEHOLDER_BEGIN:"+tab_id+">#");code=code.substr(start_ix+4,m[3].length)+"#<CHAP_PLACEHOLDER_END:"+tab_id+">#"+code.substr(start_ix+m[0].length-m[1].length);any_change=true}else{break}}code_chunks.push(code);code=code_chunks.join("")}re=/#<CHAP_PLACEHOLDER_BEGIN\:(\d)>#/;while(true){m=re.exec(code);if(null==m){break}tabstops[m[1]][1]=tabstops[m[1]][1].replace(/#<CHAP_PLACEHOLDER_(BEGIN|END):\d>#/g,"");tabstops[m[1]][2]=m.index;tabstops[m[1]][3]=tabstops[m[1]][1].length;code=code.substr(0,m.index)+code.substr(m.index+m[0].length).replace("#<CHAP_PLACEHOLDER_END:"+m[1]+">#","")}re=/\{\$\{(\d)\:([^\}]*)\}\}/;while(true){m=re.exec(code);if(null==m){break}code=code.substr(0,m.index)+m[2]+code.substr(m.index+m[0].length);var ix_end=code.indexOf("{$"+m[1]+"}");if(-1==ix_end){console.error("Invalid snippet definition. Mirror `?` does not have `{$?}` mirrored location specified.".embed(m[1],m[1]));break}tabstops[m[1]]=["mi",m[2],m.index,m[2].length,ix_end];if(m.index>ix_end){console.error("Unsupported feature. Mirror `?` should have mirrored location positioned AFTER itself.".embed(m[1]))}code=code.substr(0,ix_end)+code.substr(ix_end+4)}re=/(^|[^\\])\$(\d)/;while(true){m=re.exec(code);if(null==m){break}tab_id=m[2];if(tabstops[tab_id]){console.error("Invalid snippet definition. Tabstop `?` already defined as placeholder at position `?`. Snippet source: `?`.".embed(tab_id,m.index,code));break}var start_ix=m.index+m[1].length;tabstops[tab_id]=["ts","",start_ix,0];code=code.substr(0,start_ix)+code.substr(start_ix+2);var offset=m[1].length+2;for(var tab_id in tabstops){if("mi"==tabstops[tab_id][0]){if(start_ix<tabstops[tab_id][2]){tabstops[tab_id][2]-=offset}if(start_ix<tabstops[tab_id][4]){tabstops[tab_id][4]-=offset}}else{if("ph"==tabstops[tab_id][0]&&start_ix<tabstops[tab_id][2]){tabstops[tab_id][2]-=offset}}}}if(!tabstops[0]){tabstops[0]=["ts","",code.length,0]}code=code.replace(/\0/g,"$");for(var tab_id in tabstops){var placeholder=tabstops[tab_id]}var scc={firstInitialized:true,insertCaretPosition:[caretRow,caretCol],tabstops:tabstops,callbackIndex:-1,activeTabStopIndex:tabstops[1]?1:0,activeTabStopRange:[],activeTabStopContent:"",activeTabStopNested:[],wasSelection:wasSelection,tabActivation:tabActivation};if(!scc.wasSelection){component.runAction(ac.chap.ACTION_CARET,{move:"prev_word"});component.runAction(ac.chap.ACTION_SELECTION,{add:true});component.runAction(ac.chap.ACTION_DELETE,{character:true})}var tabstop=tabstops[scc.activeTabStopIndex];component.runAction(ac.chap.ACTION_INSERT,{string:code.substr(0,tabstop[2])});component.runAction(ac.chap.ACTION_INSERT,{string:code.substr(tabstop[2]),skipCaretChange:true});var selection_changed=false;if(""!=tabstop[1]){component.runAction(ac.chap.ACTION_CARET,{store:true});component.runAction(ac.chap.ACTION_CARET,{moveBy:"column",value:tabstop[1].length});component.runAction(ac.chap.ACTION_SELECTION,{add:true});selection_changed=true}if(0!=scc.activeTabStopIndex){this.snippetCompleteCache=scc;this.snippetCompleteCache.callbackIndex=component.addActionListener(ac.chap.ACTION_LISTENER_BOTH,this,this.snippetCompleteActionListener)}}return ac.chap.ACTION_RES_REDRAWCARET|ac.chap.ACTION_RES_REDRAWTEXT|(selection_changed?ac.chap.ACTION_RES_SELECTIONCHANGED:0)};ac.chap.KeyMap.prototype.snippetCompleteActionListener=function(K,P,E,X,J,V,W,U){var F=P.snippetCompleteCache;if(ac.chap.ACTION_LISTENER_BEFORE==E&&!F.firstInitialized){if(W<F.activeTabStopRange[0]||W>F.activeTabStopRange[2]||U<F.activeTabStopRange[1]||U>F.activeTabStopRange[3]){K.removeActionListener(F.callbackIndex);K.removeSelection();delete P.snippetCompleteCache;return }}else{if(F.firstInitialized){F.firstInitialized=false;var M=F.tabstops[F.activeTabStopIndex];U-=M[1].length;var Y=M[1].split("\n");var I=Y.length;var B=W+I-1;var A=(B==W?U:0)+Y[I-1].length;F.activeTabStopRange=[W,U,B,A];F.stopMarker=K.char_map[B].substr(A);for(var S in F.tabstops){if(S==F.activeTabStopIndex){continue}var N=F.tabstops[S];if(N[2]>=M[2]&&(N[2]+N[3]<=M[2]+M[3])){F.activeTabStopNested[S]=true}}if("mi"!=M[0]){F.activeTabStopContent=M[1]}F.firstRealRun=false}else{var O=K.char_map.length;var S=F.activeTabStopRange[0];var L=false;var H=50;var T="";var R=F.activeTabStopContent;while(S<O&&0<H--){var D=""==F.stopMarker?K.char_map[S].length:K.char_map[S].indexOf(F.stopMarker);if(-1!=D){F.activeTabStopRange[2]=S;F.activeTabStopRange[3]=D;T+=(S==F.activeTabStopRange[0]?K.char_map[S].substring(F.activeTabStopRange[1],D):K.char_map[S].substr(0,D));F.activeTabStopContent=T;L=true;break}T+=(S==F.activeTabStopRange[0]?K.char_map[S].substr(F.activeTabStopRange[1]):K.char_map[S])+"\n";S++}if(!F.firstRealRun){F.activeTabStopContent=T}if(!L){K.removeActionListener(F.callbackIndex);K.removeSelection();delete P.snippetCompleteCache;return }var G=T.length-R.length;if("mi"==F.tabstops[F.activeTabStopIndex][0]){var C=[K.caret.position[0],K.caret.position[1]];K.stopActionListeners();K.runAction(ac.chap.ACTION_SELECTION,{remove:true});K.runAction(ac.chap.ACTION_CARET,{moveTo:[F.activeTabStopRange[0],F.activeTabStopRange[1]]});K.runAction(ac.chap.ACTION_CARET,{moveBy:"column",value:(1+F.tabstops[F.activeTabStopIndex][4]-F.tabstops[F.activeTabStopIndex][2]-F.tabstops[F.activeTabStopIndex][3]+T.length)});if(0<R.length){K.runAction(ac.chap.ACTION_CARET,{store:true});K.runAction(ac.chap.ACTION_CARET,{moveBy:"column",value:R.length});K.runAction(ac.chap.ACTION_SELECTION,{add:true});K.runAction(ac.chap.ACTION_DELETE,{character:false})}K.runAction(ac.chap.ACTION_INSERT,{string:T});K.runAction(ac.chap.ACTION_CARET,{moveTo:C});K.startActionListeners();if(0<F.tabstops[F.activeTabStopIndex][4]){F.stopMarker=K.char_map[F.activeTabStopRange[2]].substr(F.activeTabStopRange[3])}}if(!F.firstRealRun){F.firstRealRun=true;if("mi"==F.tabstops[F.activeTabStopIndex][0]&&""!=F.tabstops[F.activeTabStopIndex][1]){G=T.length-F.tabstops[F.activeTabStopIndex][1].length}}var Q=F.tabstops[F.activeTabStopIndex][2];if(0!=G){for(S in F.tabstops){if(S==F.activeTabStopIndex){continue}var M=F.tabstops[S];if(M[2]>Q){if(F.activeTabStopNested[S]){delete F.tabstops[S]}else{M[2]+=G}}}}}}};ac.chap.KeyMap.prototype.compile=function(source){var rows=source.split("\n");var n=rows.length;var re_definition=/^KEY\:\s*[-\d]*[\+\w\s]*$/;var re_chain=/^[^\(]*\(.*\)\s*$/;var src="";var chain=[];var last_key_code=null;for(var i=0;i<n;i++){rows[i]=rows[i].trim();if(re_definition.test(rows[i])){if(null!=last_key_code){src+=chain.join(",\n");src+="\n];\n";chain=[]}var s=rows[i].split(":")[1].split("+");var key_code=parseInt(s[0]);var control_keys=["ac.chap.CKEY_NONE"];for(var ii=1;ii<s.length;ii++){control_keys.push("ac.chap.CKEY_"+s[ii].trim().toUpperCase())}src+="\nif('undefined'==typeof this.definition['?']) {this.definition['?']=[];}\n".embed(key_code,key_code);src+="this.definition['?'][?] = [\n".embed(key_code,control_keys.join("|"));last_key_code=key_code}if(re_chain.test(rows[i])){var ix=rows[i].indexOf("(");var action_type="ac.chap.ACTION_"+rows[i].substr(0,ix).trim().toUpperCase();var params=rows[i].substring(ix+1,rows[i].length-1).replace(/\:CR/g,"\\n");chain.push(action_type+", {"+params+"}")}}if(null!=last_key_code){src+=chain.join(",\n");src+="\n];\n";chain=[]}var result=true;try{eval(src)}catch(e){result=e;console.error("Error while compiling Chap keymap definition: %o. Compiled source: %s",e,src)}return result};ac.chap.keymap={};$class("ac.chap.Theme",{construct:function(){this.colorScheme=[];this.initDefinition()}});ac.chap.Theme.prototype.initDefinition=function(){this.cssId="";this.background="#fff";this.textColor="#000";this.caretRowStyleActive="#ededed";this.selectionStyle="#c4dbff";this.caretColor="#000"};ac.chap.Theme.prototype.renderCaret=function(B,A){if(1==B){A.style.borderRight="1px solid "+this.caretColor}else{A.style.height=(parseInt(A.style.height)-1)+"px";A.style.borderBottom="1px solid "+this.caretColor}};ac.chap.Theme.prototype.adjustCaretPosition=function(A,B){if(1==A){B[0]++}else{B[0]+=B[2]}return B};ac.chap.theme={};$class("ac.chap.Language",{construct:function(){this.foldingStartMarkers=[];this.foldingStopMarkers=[];this.singleRowCommentStartMarkers=[];this.multiRowCommentStartMarker="";this.multiRowCommentEndMarker="";this.initDefinition()}});ac.chap.Language.prototype.initDefinition=function(){this.singleQuoteStringMarker="'";this.singleQuoteStringMarkerException="\\";this.doubleQuoteStringMarker='"';this.doubleQuoteStringMarkerException="\\";this.chunkRules=[[/(([^\w]|^)(\d{1,}[\d\.Ee]*)([^w]|$))/i,3,ac.chap.CHUNK_NUMBER],[/(\+|\-|\*|\/|\=|\!|\^|\%|\||\&|\<|\>)/i,0,ac.chap.CHUNK_OPERATOR],[/(\(|\)|\[|\]|\{|\})/i,0,ac.chap.CHUNK_PARENTHESIS]];this.wordDelimiter=/[\w\.\d]/;this.indentIgnoreMarker=/[\.]/};ac.chap.lang={};function showEditor(D){var G=D.value;D=$(D);var B=D.w();var E=D.h();var F=D.p().ib($$(),D).w(B).h(E);D.d(false);var H=ac.chap.lang.JavaScript;var C=ac.chap.keymap.EAmyJavaScript;var A=$new(ac.chap.Window,{language:ac.chap.lang.EAmy,keymap:ac.chap.Keymap});A.addView(F,{theme:ac.chap.theme.EAmy,rowHeight:11,colWidth:7,wordWrap:true,tabelator:"    "});A.show();A.setSnippets(eamy.snippets);A.keymap.importSnippets(eamy.snippets);A.edit(G);eamy.instances.push(A)}document.write('<link rel="stylesheet" href="eamy/style.css" type="text/css" media="screen" title="no title" charset="utf-8" />');$__tune.event.addListener(self,"load",function(B){var A=document.getElementsByTagName("textarea");for(var C=0;C<A.length;C++){var D=A.item(C);if("true"==D.getAttribute("-amy-enabled")){showEditor(D);var E=D;while(document!=E.parentNode){if("form"==E.tagName.toLowerCase()){eamy.action=E.action;eamy.form=E;eamy.textarea=D;E.action=null;E.onsubmit=function(){setTimeout("eamy.submit()",50);return false}}E=E.parentNode}break}}});eamy.submit=function(){eamy.form.action=eamy.action;eamy.form.onsubmit=null;if($__tune.isSafari2){eamy.textarea.innerHTML=eamy.instances[0].getText()}else{eamy.textarea.value=eamy.instances[0].getText()}eamy.form.submit()};if(!self.console){var console={info:function(){}};console.log=console.error=console.warn=console.info};